<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Game Scout - –ü–ª–∞—Ç—Ñ–æ—Ä–º–∞ –ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–æ–Ω–Ω–æ–π –ê–Ω–∞–ª–∏—Ç–∏–∫–∏</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --graphite-dark: #1a1d23;
            --graphite-medium: #2d3139;
            --graphite-light: #3f4451;
            --accent-blue: #4a9eff;
            --accent-green: #4caf50;
            --accent-orange: #ff9800;
            --accent-red: #f44336;
            --text-primary: #e8eaed;
            --text-secondary: #9aa0a6;
            --success: #34d399;
            --warning: #fbbf24;
            --danger: #ef4444;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: linear-gradient(135deg, var(--graphite-dark) 0%, #0f1116 100%);
            color: var(--text-primary);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            background: var(--graphite-medium);
            border-radius: 16px;
            padding: 30px;
            margin-bottom: 30px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        .header h1 {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 10px;
            background: linear-gradient(135deg, var(--accent-blue), var(--accent-green));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header p {
            color: var(--text-secondary);
            font-size: 1.1rem;
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .tab {
            padding: 12px 24px;
            background: var(--graphite-medium);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 1rem;
            font-weight: 500;
            color: var(--text-secondary);
        }

        .tab:hover {
            background: var(--graphite-light);
            border-color: var(--accent-blue);
        }

        .tab.active {
            background: var(--accent-blue);
            color: white;
            border-color: var(--accent-blue);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: var(--graphite-medium);
            border-radius: 12px;
            padding: 24px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: transform 0.3s, box-shadow 0.3s;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 24px rgba(74, 158, 255, 0.2);
        }

        .stat-value {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .stat-label {
            color: var(--text-secondary);
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .games-container {
            background: var(--graphite-medium);
            border-radius: 12px;
            padding: 24px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .games-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .games-header h2 {
            font-size: 1.5rem;
        }

        .filter-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .filter-btn {
            padding: 8px 16px;
            background: var(--graphite-light);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.9rem;
            color: var(--text-primary);
        }

        .filter-btn:hover {
            background: var(--graphite-dark);
            border-color: var(--accent-blue);
        }

        .filter-btn.active {
            background: var(--accent-blue);
            border-color: var(--accent-blue);
        }

        .games-table {
            width: 100%;
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th {
            text-align: left;
            padding: 12px;
            color: var(--text-secondary);
            font-weight: 600;
            font-size: 0.85rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            border-bottom: 2px solid var(--graphite-light);
        }

        td {
            padding: 16px 12px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        tr:hover {
            background: rgba(74, 158, 255, 0.05);
        }

        .game-link {
            color: var(--accent-blue);
            text-decoration: none;
            font-weight: 600;
            cursor: pointer;
            transition: color 0.3s;
        }

        .game-link:hover {
            color: #3a8eef;
            text-decoration: underline;
        }

        .badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .badge-gem { background: rgba(52, 211, 153, 0.2); color: var(--success); }
        .badge-fixable { background: rgba(251, 191, 36, 0.2); color: var(--warning); }
        .badge-risk { background: rgba(239, 68, 68, 0.2); color: var(--danger); }
        .badge-watch { background: rgba(74, 158, 255, 0.2); color: var(--accent-blue); }

        .score-pill {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 6px;
            font-weight: 600;
            min-width: 40px;
            text-align: center;
        }

        .score-high { background: rgba(52, 211, 153, 0.3); color: var(--success); }
        .score-medium { background: rgba(251, 191, 36, 0.3); color: var(--warning); }
        .score-low { background: rgba(239, 68, 68, 0.3); color: var(--danger); }

        .loading {
            text-align: center;
            padding: 40px;
            color: var(--text-secondary);
        }

        .spinner {
            border: 3px solid rgba(255, 255, 255, 0.1);
            border-top: 3px solid var(--accent-blue);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 16px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .actions {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 12px 24px;
            background: var(--accent-blue);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            font-size: 1rem;
        }

        .btn:hover {
            background: #3a8eef;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(74, 158, 255, 0.3);
        }

        .btn:disabled {
            background: var(--graphite-light);
            cursor: not-allowed;
            transform: none;
        }

        .btn-success { background: var(--accent-green); }
        .btn-success:hover { background: #3d9b40; }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .alert {
            padding: 16px;
            border-radius: 8px;
            margin-bottom: 20px;
            border: 1px solid;
        }

        .alert-success {
            background: rgba(52, 211, 153, 0.1);
            border-color: var(--success);
            color: var(--success);
        }

        .alert-error {
            background: rgba(239, 68, 68, 0.1);
            border-color: var(--danger);
            color: var(--danger);
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--graphite-medium);
            border-radius: 16px;
            padding: 30px;
            max-width: 800px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-close {
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: 2rem;
            cursor: pointer;
            padding: 0;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            transition: all 0.3s;
        }

        .modal-close:hover {
            background: var(--graphite-light);
            color: var(--text-primary);
        }

        .detail-row {
            display: flex;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        .detail-label {
            color: var(--text-secondary);
            font-weight: 600;
        }

        @media (max-width: 768px) {
            .header h1 { font-size: 1.8rem; }
            .stats-grid { grid-template-columns: 1fr; }
            .games-header { flex-direction: column; align-items: flex-start; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üéØ Game Scout</h1>
            <p>–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞ –ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–æ–Ω–Ω–æ–π –ê–Ω–∞–ª–∏—Ç–∏–∫–∏ - –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –†—ã–Ω–∫–∞ –≤ –†–µ–∞–ª—å–Ω–æ–º –í—Ä–µ–º–µ–Ω–∏</p>
        </div>

        <div class="tabs">
            <div class="tab active" onclick="switchTab('analytics')">üìä –ê–Ω–∞–ª–∏—Ç–∏–∫–∞</div>
            <div class="tab" onclick="switchTab('games')">üéÆ –ë–∞–∑–∞ –ò–≥—Ä</div>
            <div class="tab" onclick="switchTab('trends')">üéØ Trend Radar</div>
            <div class="tab" onclick="switchTab('pitches')">üí° –û—Ü–µ–Ω–∫–∞ –ü–∏—Ç—á–µ–π</div>
        </div>

        <div id="alert-container"></div>

        <!-- Analytics Tab -->
        <div id="analytics-tab" class="tab-content active">
            <div class="stats-grid" id="stats-grid">
                <div class="loading">
                    <div class="spinner"></div>
                    <p>–ó–∞–≥—Ä—É–∑–∫–∞ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏...</p>
                </div>
            </div>

            <div class="games-container">
                <div class="games-header">
                    <h2>–ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–æ–Ω–Ω—ã–µ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏</h2>
                    <div class="filter-buttons">
                        <button class="filter-btn active" onclick="filterGames('all')">–í—Å–µ</button>
                        <button class="filter-btn" onclick="filterGames('undermarketed_gem')">üíé –ù–µ–¥–æ–æ—Ü–µ–Ω—ë–Ω–Ω—ã–µ</button>
                        <button class="filter-btn" onclick="filterGames('marketing_fixable')">üîß –ò—Å–ø—Ä–∞–≤–∏–º–æ</button>
                        <button class="filter-btn" onclick="filterGames('product_risk')">‚ö†Ô∏è –†–∏—Å–∫</button>
                    </div>
                </div>
                <div class="games-table" id="games-table">
                    <div class="loading">
                        <div class="spinner"></div>
                        <p>–ó–∞–≥—Ä—É–∑–∫–∞ –∏–≥—Ä...</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Games Tab -->
        <div id="games-tab" class="tab-content">
            <div class="actions">
                <button class="btn btn-success" onclick="collectSteam()" id="btn-steam">üîÑ –°–æ–±—Ä–∞—Ç—å Steam</button>
                <button class="btn" onclick="refreshGamesTab()">‚Üª –û–±–Ω–æ–≤–∏—Ç—å</button>
            </div>
            <div class="games-container">
                <div class="games-header">
                    <h2>–í—Å–µ –ò–≥—Ä—ã –≤ –ë–∞–∑–µ</h2>
                    <p style="color: var(--text-secondary);">–í—Å–µ–≥–æ –∏–≥—Ä: <span id="total-games-count">-</span></p>
                
        <!-- Trends Tab -->
        <div id="trends-tab" class="tab-content">
            <div class="games-container">
                <h2 style="margin-bottom: 10px;">üéØ YouTube Trend Radar</h2>
                <p style="color: var(--text-secondary); margin-bottom: 30px;">
                    –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –ø–æ–∏—Å–∫–æ–≤—ã–µ –∑–∞–ø—Ä–æ—Å—ã –Ω–∞ –æ—Å–Ω–æ–≤–µ –∞–Ω–∞–ª–∏–∑–∞ YouTube —Ç—Ä–µ–Ω–¥–æ–≤
                </p>
                
                <h3 style="margin: 30px 0 15px;">üìã –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ Query:</h3>
                <div id="trend-queries-grid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 15px; margin-bottom: 40px;"></div>
                
                <h3 style="margin: 30px 0 15px;">üî• –¢–æ–ø –ú–µ—Ö–∞–Ω–∏–∫–∏ –∏ –ü–∞—Ç—Ç–µ—Ä–Ω—ã:</h3>
                <div id="trend-snapshots-grid" style="display: flex; gap: 20px; flex-wrap: wrap;"></div>
            </div>
        </div></div>
                <div class="games-table" id="all-games-table">
                    <div class="loading">
                        <div class="spinner"></div>
                        <p>–ó–∞–≥—Ä—É–∑–∫–∞ –≤—Å–µ—Ö –∏–≥—Ä...</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Pitches Tab -->
        <div id="pitches-tab" class="tab-content">
            <div class="games-container">
                <h2>–°–∏—Å—Ç–µ–º–∞ –û—Ü–µ–Ω–∫–∏ –ü–∏—Ç—á–µ–π</h2>
                <p style="color: var(--text-secondary); margin-top: 10px;">–°–∫–æ—Ä–æ - –û—Ç–ø—Ä–∞–≤—å—Ç–µ —Å–≤–æ–π –ø–∏—Ç—á –¥–ª—è AI-–∞–Ω–∞–ª–∏–∑–∞</p>
            </div>
        </div>
    </div>

    <!-- Game Details Modal -->
    <div id="game-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modal-game-title">–ó–∞–≥—Ä—É–∑–∫–∞...</h2>
                <button class="modal-close" onclick="closeModal()">&times;</button>
            </div>
            <div id="modal-game-details">
                <div class="loading">
                    <div class="spinner"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentFilter = 'all';
        let allGames = [];
        let allGamesData = [];

        function switchTab(tabName) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(tabName + '-tab').classList.add('active');

            if (tabName === 'analytics') {
                loadAnalytics();
            } else if (tabName === 'games') {
                loadAllGames();
            }
        }

        function showAlert(message, type = 'success') {
            const container = document.getElementById('alert-container');
            const alert = document.createElement('div');
            alert.className = `alert alert-${type}`;
            alert.textContent = message;
            container.appendChild(alert);
            
            setTimeout(() => {
                alert.remove();
            }, 5000);
        }

        async function loadAnalytics() {
            try {
                const response = await fetch('/api/v1/analytics/dashboard');
                const data = await response.json();
                
                renderStats(data);
                loadInvestmentGames();
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏:', error);
                showAlert('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏', 'error');
            }
        }

        function renderStats(data) {
            const colors = ['#4a9eff', '#34d399', '#fbbf24', '#ef4444'];
            const html = `
                <div class="stat-card">
                    <div class="stat-value" style="color: ${colors[0]}">${data.total_games}</div>
                    <div class="stat-label">–í—Å–µ–≥–æ –ò–≥—Ä</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" style="color: ${colors[1]}">${data.games_scored}</div>
                    <div class="stat-label">–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–æ</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" style="color: ${colors[2]}">${data.undermarketed_gems}</div>
                    <div class="stat-label">ÔøΩÔøΩ –ù–µ–¥–æ–æ—Ü–µ–Ω—ë–Ω–Ω—ã–µ</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" style="color: ${colors[0]}">${data.avg_product_potential.toFixed(1)}</div>
                    <div class="stat-label">–°—Ä–µ–¥–Ω–∏–π PP</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" style="color: ${colors[1]}">${data.avg_gtm_execution.toFixed(1)}</div>
                    <div class="stat-label">–°—Ä–µ–¥–Ω–∏–π GTM</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" style="color: ${colors[2]}">${data.avg_gap_score.toFixed(1)}</div>
                    <div class="stat-label">–°—Ä–µ–¥–Ω–∏–π GAP</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" style="color: ${colors[0]}">${data.games_with_ewi}</div>
                    <div class="stat-label">–° EWI</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" style="color: ${colors[3]}">${data.avg_ewi || 'N/A'}</div>
                    <div class="stat-label">–°—Ä–µ–¥–Ω–∏–π EWI</div>
                </div>
            `;
            document.getElementById('stats-grid').innerHTML = html;
        }

        async function loadInvestmentGames() {
            try {
                const response = await fetch('/api/v1/analytics/games/enriched?limit=100');
                allGames = await response.json();
                renderGames(allGames);
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–≥—Ä:', error);
                document.getElementById('games-table').innerHTML = '<p style="color: var(--danger); padding: 20px;">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–≥—Ä</p>';
            }
        }

        function filterGames(category) {
            document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
            event.target.classList.add('active');
            currentFilter = category;

            const filtered = category === 'all' 
                ? allGames 
                : allGames.filter(g => g.scores && g.scores.investor_category === category);
            
            renderGames(filtered);
        }

        function renderGames(games) {
            if (games.length === 0) {
                document.getElementById('games-table').innerHTML = '<p style="color: var(--text-secondary); padding: 20px;">–ò–≥—Ä—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã. –ù–∞–∂–º–∏—Ç–µ "–ë–∞–∑–∞ –ò–≥—Ä" ‚Üí "–°–æ–±—Ä–∞—Ç—å Steam" —á—Ç–æ–±—ã –¥–æ–±–∞–≤–∏—Ç—å –∏–≥—Ä—ã.</p>';
                return;
            }

            const html = `
                <table>
                    <thead>
                        <tr>
                            <th>–ò–≥—Ä–∞</th>
                            <th>–ö–∞—Ç–µ–≥–æ—Ä–∏—è</th>
                            <th>PP</th>
                            <th>GTM</th>
                            <th>GAP</th>
                            <th>Fix</th>
                            <th>–ò—Å—Ç–æ—á–Ω–∏–∫</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${games.map(game => `
                            <tr>
                                <td><a href="#" class="game-link" onclick="showGameDetails('${game.game_id}'); return false;">${game.title}</a></td>
                                <td>${renderCategoryBadge(game.scores?.investor_category)}</td>
                                <td>${renderScore(game.scores?.product_potential)}</td>
                                <td>${renderScore(game.scores?.gtm_execution)}</td>
                                <td>${renderScore(game.scores?.gap_score)}</td>
                                <td>${renderScore(game.scores?.fixability_score)}</td>
                                <td><span style="color: var(--text-secondary)">${game.source}</span></td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
            document.getElementById('games-table').innerHTML = html;
        }

        function renderCategoryBadge(category) {
            if (!category) return '-';
            const badges = {
                'undermarketed_gem': '<span class="badge badge-gem">üíé –ù–ï–î–û–û–¶–ï–ù–Å–ù–ù–ê–Ø</span>',
                'marketing_fixable': '<span class="badge badge-fixable">üîß –ò–°–ü–†–ê–í–ò–ú–û</span>',
                'product_risk': '<span class="badge badge-risk">‚ö†Ô∏è –†–ò–°–ö</span>',
                'watch': '<span class="badge badge-watch">üëÄ –ù–ê–ë–õ–Æ–î–ê–¢–¨</span>'
            };
            return badges[category] || category;
        }

        function renderScore(score) {
            if (score === null || score === undefined) return '-';
            const val = parseFloat(score);
            const cls = val >= 7 ? 'score-high' : val >= 4 ? 'score-medium' : 'score-low';
            return `<span class="score-pill ${cls}">${val.toFixed(1)}</span>`;
        }

        async function loadAllGames() {
            try {
                const response = await fetch('/api/v1/analytics/games/enriched?limit=200');
                allGamesData = await response.json();
                document.getElementById('total-games-count').textContent = allGamesData.length;
                renderAllGamesTable(allGamesData);
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –≤—Å–µ—Ö –∏–≥—Ä:', error);
                document.getElementById('all-games-table').innerHTML = '<p style="color: var(--danger); padding: 20px;">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–≥—Ä</p>';
            }
        }

        function renderAllGamesTable(games) {
            if (games.length === 0) {
                document.getElementById('all-games-table').innerHTML = '<p style="color: var(--text-secondary); padding: 20px;">–ò–≥—Ä—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã. –ù–∞–∂–º–∏—Ç–µ "–°–æ–±—Ä–∞—Ç—å Steam" —á—Ç–æ–±—ã –¥–æ–±–∞–≤–∏—Ç—å –∏–≥—Ä—ã.</p>';
                return;
            }

            const html = `
                <table>
                    <thead>
                        <tr>
                            <th>–ò–≥—Ä–∞</th>
                            <th>–ò—Å—Ç–æ—á–Ω–∏–∫</th>
                            <th>–°—Ç–∞—Ç—É—Å</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${games.map(game => `
                            <tr>
                                <td><a href="#" class="game-link" onclick="showGameDetails('${game.game_id}'); return false;">${game.title}</a></td>
                                <td><span style="color: var(--text-secondary)">${game.source}</span></td>
                                <td>${game.scores ? '‚úÖ –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞' : '‚è≥ –û–∂–∏–¥–∞–µ—Ç –∞–Ω–∞–ª–∏–∑–∞'}</td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
            document.getElementById('all-games-table').innerHTML = html;
        }

        async function showGameDetails(gameId) {
            const modal = document.getElementById('game-modal');
            modal.classList.add('active');
            
            try {
                const response = await fetch(`/api/v1/analytics/games/${gameId}/details`);
                const data = await response.json();
                
                document.getElementById('modal-game-title').textContent = data.game.title;
                
                const detailsHtml = `
                    <div class="detail-row">
                        <span class="detail-label">–ò—Å—Ç–æ—á–Ω–∏–∫:</span>
                        <span>${data.game.source}</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">URL:</span>
                        <a href="${data.game.url}" target="_blank" style="color: var(--accent-blue)">${data.game.url}</a>
                    </div>
                    ${data.investment_score ? `
                        <h3 style="margin-top: 20px; margin-bottom: 10px;">Investment Score</h3>
                        <div class="detail-row">
                            <span class="detail-label">Product Potential:</span>
                            <span>${renderScore(data.investment_score.pp)}</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">GTM Execution:</span>
                            <span>${renderScore(data.investment_score.gtm)}</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">GAP Score:</span>
                            <span>${renderScore(data.investment_score.gap)}</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Fixability:</span>
                            <span>${renderScore(data.investment_score.fix)}</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Category:</span>
                            <span>${renderCategoryBadge(data.investment_score.category)}</span>
                        </div>
                        <div style="margin-top: 15px; padding: 15px; background: var(--graphite-dark); border-radius: 8px;">
                            ${data.investment_score.reasoning || '–ù–µ—Ç –æ–ø–∏—Å–∞–Ω–∏—è'}
                        </div>
                    ` : '<p style="color: var(--text-secondary)">–ò–≥—Ä–∞ –µ—â—ë –Ω–µ –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞</p>'}
                    
                    ${data.videos && data.videos.length > 0 ? `
                        <h3 style="margin-top: 20px; margin-bottom: 10px;">External Videos (${data.videos.length})</h3>
                        ${data.videos.map(v => `
                            <div class="detail-row">
                                <span class="detail-label">${v.platform}:</span>
                                <a href="${v.url}" target="_blank" style="color: var(--accent-blue)">${v.title || 'Video'}</a>
                            </div>
                        `).join('')}
                    ` : ''}
                `;
                
                document.getElementById('modal-game-details').innerHTML = detailsHtml;
            } catch (error) {
                console.error('Error loading game details:', error);
                document.getElementById('modal-game-details').innerHTML = '<p style="color: var(--danger)">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–µ—Ç–∞–ª–µ–π</p>';
            }
        }

        function closeModal() {
            document.getElementById('game-modal').classList.remove('active');
        }

        async function collectSteam() {
            const btn = document.getElementById('btn-steam');
            btn.disabled = true;
            btn.textContent = '‚è≥ –°–æ–±–∏—Ä–∞–µ–º...';
            
            try {
                const response = await fetch('/api/v1/narrative/test-steam-collector', { method: 'POST' });
                const data = await response.json();
                showAlert('Steam –∫–æ–ª–ª–µ–∫—Ü–∏—è –∑–∞–ø—É—â–µ–Ω–∞! –ü–æ–¥–æ–∂–¥–∏—Ç–µ 30 —Å–µ–∫—É–Ω–¥...', 'success');
                setTimeout(() => {
                    loadAllGames();
                    loadAnalytics();
                }, 30000);
            } catch (error) {
                showAlert('–û—à–∏–±–∫–∞ –∑–∞–ø—É—Å–∫–∞ Steam –∫–æ–ª–ª–µ–∫—Ü–∏–∏', 'error');
            } finally {
                btn.disabled = false;
                btn.textContent = 'üîÑ –°–æ–±—Ä–∞—Ç—å Steam';
            }
        }

        function refreshGamesTab() {
            loadAllGames();
        }

        // Close modal on outside click
        document.getElementById('game-modal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeModal();
            }
        });

        loadAnalytics();
    
        // Trend Radar Functions
        async function loadTrendRadar() { console.log("Trend start"); 
    document.getElementById('trend-queries-grid').innerHTML = `
        <div style="background: #2d3139; padding: 15px; border-radius: 8px; margin: 10px;">
            <div style="font-size: 1.1rem; font-weight: 600; color: white;">indie indie game</div>
            <span style="background: rgba(74,158,255,0.2); color: #4a9eff; padding: 4px 12px; border-radius: 12px; font-size: 0.75rem;">indie</span>
        </div>
        <div style="background: #2d3139; padding: 15px; border-radius: 8px; margin: 10px;">
            <div style="font-size: 1.1rem; font-weight: 600; color: white;">deckbuilder weak to strong</div>
            <span style="background: rgba(251,191,36,0.2); color: #fbbf24; padding: 4px 12px; border-radius: 12px; font-size: 0.75rem;">deckbuilder</span>
        </div>
    `;
    document.getElementById('trend-snapshots-grid').innerHTML = `
        <div style="background: #2d3139; padding: 20px; border-radius: 12px; color: white;">
            <h4 style="color: #4a9eff;">indie_radar</h4>
            <p style="color: #9aa0a6;">2026-01-12</p>
            <strong>–ú–µ—Ö–∞–Ω–∏–∫–∏:</strong> deckbuilder, automation, extraction
        </div>
    `;
}).join('');
                
                document.getElementById('trend-queries-grid').innerHTML = queriesHTML || '<p style="color: var(--text-secondary);">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö</p>';} catch(e) { console.error("‚ùå Error:", e); alert("Error: " + e.message); }
                
                // Render snapshots
                if (snapshots.length > 0) {
                    const snapshotsHTML = snapshots.map(s => `
                        <div style="background: var(--graphite-medium); padding: 20px; border-radius: 12px; flex: 1; min-width: 300px; border: 1px solid rgba(255,255,255,0.05);">
                            <h4 style="margin: 0 0 8px 0; color: var(--accent-blue);">${s.query_set}</h4>
                            <p style="color: var(--text-secondary); font-size: 0.9rem; margin: 0 0 15px 0;">–î–∞—Ç–∞: ${s.date}</p>
                            
                            <div style="margin-top: 12px;">
                                <strong style="color: var(--text-primary);">–ú–µ—Ö–∞–Ω–∏–∫–∏:</strong><br>
                                ${s.top_mechanics.map(m => `<span class="badge badge-fixable" style="margin: 4px 4px 4px 0;">${m}</span>`).join('')}
                            </div>
                            
                            <div style="margin-top: 12px;">
                                <strong style="color: var(--text-primary);">–ü–∞—Ç—Ç–µ—Ä–Ω—ã:</strong><br>
                                ${s.top_patterns.map(p => `<span class="badge badge-gem" style="margin: 4px 4px 4px 0;">${p.replace('_', ' ')}</span>`).join('')}
                            </div>
                        </div>
                    `).join('');
                    
                    document.getElementById('trend-snapshots-grid').innerHTML = snapshotsHTML;
                } else {
                    document.getElementById('trend-snapshots-grid').innerHTML = '<p style="color: var(--text-secondary);">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö</p>';
                }
            } catch (e) {
                console.error('Error loading trends:', e);
                document.getElementById('trend-queries-grid').innerHTML = '<p style="color: red;">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏</p>';} catch(e) { console.error("‚ùå Error:", e); alert("Error: " + e.message); }
            }
        }
        
        // Patch switchTab
        const originalSwitchTab = window.switchTab;
        window.switchTab = function(tab) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            
            if (tab === 'trends') {
                event.target.classList.add('active');
                document.getElementById('trends-tab').classList.add('active');
                loadTrendRadar();
            } else if (tab === 'analytics') {
                event.target.classList.add('active');
                document.getElementById('analytics-tab').classList.add('active');
                loadAnalytics().catch(e => console.error(e));
            } else if (tab === 'games') {
                event.target.classList.add('active');
                document.getElementById('games-tab').classList.add('active');
                loadAllGames();
            } else if (tab === 'pitches') {
                event.target.classList.add('active');
                document.getElementById('pitches-tab').classList.add('active');
            }
        };

        </script>
</body>
</html>
