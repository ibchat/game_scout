<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Game Scout ‚Äî Dashboard</title>
    <style>
    :root{
      --bg: #0b0f14;
      --panel: rgba(255,255,255,0.06);
      --panel2: rgba(255,255,255,0.08);
      --stroke: rgba(255,255,255,0.10);
      --text: rgba(255,255,255,0.92);
      --muted: rgba(255,255,255,0.65);
      --blue: #6ea8ff;
      --green: #79e29b;
      --orange: #ffb86b;
      --red: #ff6b81;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono","Courier New", monospace;
    }
    *{ box-sizing:border-box; }
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Apple Color Emoji","Segoe UI Emoji";
      background: radial-gradient(1200px 800px at 20% 0%, rgba(110,168,255,0.25), transparent 60%),
                  radial-gradient(1000px 700px at 80% 10%, rgba(121,226,155,0.18), transparent 55%),
                  radial-gradient(900px 700px at 50% 100%, rgba(255,184,107,0.10), transparent 60%),
                  var(--bg);
      color: var(--text);
    }
    .wrap{ max-width: 1200px; margin: 28px auto 60px; padding: 0 18px; }
    .hero{
      background: linear-gradient(180deg, rgba(255,255,255,0.10), rgba(255,255,255,0.06));
      border: 1px solid var(--stroke);
      border-radius: 22px;
      padding: 26px 26px 22px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.45);
      backdrop-filter: blur(12px);
    }
    .title{
      display:flex; align-items:center; gap:14px;
      font-size: 56px; line-height:1; font-weight: 800;
      color: var(--blue);
      margin: 0;
    }
    .sub{
      margin: 10px 0 0;
      color: var(--muted);
      font-size: 18px;
    }
    .tabs{
      margin-top: 18px;
      display:flex; gap: 12px;
      padding: 14px;
      background: var(--panel);
      border: 1px solid var(--stroke);
      border-radius: 18px;
      backdrop-filter: blur(10px);
      overflow:auto;
    }
    .tab{
      white-space: nowrap;
      cursor:pointer;
      padding: 10px 16px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,0.10);
      background: rgba(0,0,0,0.18);
      color: var(--muted);
      transition: 120ms ease;
      user-select:none;
      font-weight: 650;
    }
    .tab.active{
      color: var(--text);
      border-color: rgba(110,168,255,0.35);
      background: rgba(110,168,255,0.18);
      box-shadow: 0 10px 28px rgba(0,0,0,0.35);
    }
    .panel{
      margin-top: 18px;
      padding: 18px;
      background: var(--panel);
      border: 1px solid var(--stroke);
      border-radius: 22px;
      backdrop-filter: blur(12px);
      box-shadow: 0 20px 60px rgba(0,0,0,0.35);
    }
    .panel h2{ margin: 2px 0 14px; font-size: 26px; }
    .status{
      margin-top: 10px;
      padding: 14px;
      border-radius: 16px;
      border: 1px solid var(--stroke);
      background: rgba(0,0,0,0.18);
      color: var(--muted);
    }

    /* Relaunch */
    .cards{ display:grid; grid-template-columns: repeat(4, 1fr); gap: 12px; margin-top: 14px; }
    @media (max-width: 980px){ .cards{ grid-template-columns: repeat(2, 1fr);} }
    @media (max-width: 560px){ .cards{ grid-template-columns: 1fr;} }
    .kpi{
      padding: 16px;
      border-radius: 18px;
      border: 1px solid var(--stroke);
      background: rgba(0,0,0,0.18);
    }
    .kpi .label{ color: var(--muted); font-weight: 650; }
    .kpi .val{ margin-top: 6px; font-size: 38px; font-weight: 800; }
    .val.green{ color: var(--green); }
    .val.orange{ color: var(--orange); }
    .val.red{ color: var(--red); }

    .row{
      display:flex; gap: 10px; flex-wrap: wrap;
      margin-top: 14px;
      padding: 14px;
      border-radius: 18px;
      border: 1px solid var(--stroke);
      background: rgba(0,0,0,0.18);
      align-items: center;
    }
    .row .group{
      display:flex; gap:10px; flex-wrap: wrap;
      flex: 1 1 auto;
      align-items: center;
    }
    .row input{
      flex: 1 1 220px;
      padding: 12px 14px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,0.14);
      background: rgba(0,0,0,0.25);
      color: var(--text);
      outline: none;
    }
    .row .mini{
      flex: 0 0 150px;
      max-width: 180px;
    }
    .btn{
      padding: 12px 16px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,0.14);
      background: rgba(255,255,255,0.10);
      color: var(--text);
      font-weight: 750;
      cursor:pointer;
      user-select:none;
      white-space: nowrap;
    }
    .btn.primary{
      border-color: rgba(110,168,255,0.35);
      background: rgba(110,168,255,0.20);
    }
    .btn.danger{
      border-color: rgba(255,107,129,0.35);
      background: rgba(255,107,129,0.12);
    }
    .small{
      color: var(--muted);
      font-size: 13px;
      margin-top: 10px;
      line-height: 1.35;
    }
    code{
      font-family: var(--mono);
      font-size: 12px;
      padding: 2px 6px;
            border-radius: 8px;
      border: 1px solid rgba(255,255,255,0.10);
      background: rgba(0,0,0,0.20);
      color: rgba(255,255,255,0.85);
    }

    .filter{
      display:flex; gap: 10px; margin-top: 12px;
      flex-wrap: wrap;
    }
    .chip{
      cursor:pointer;
      padding: 8px 12px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,0.14);
      background: rgba(0,0,0,0.18);
      color: var(--muted);
      font-weight: 700;
    }
    .chip.active{
      color: var(--text);
      border-color: rgba(255,255,255,0.22);
      background: rgba(255,255,255,0.10);
    }

    .list{ margin-top: 14px; display:flex; flex-direction: column; gap: 12px; }
    .item{
      display:flex; justify-content: space-between; gap: 14px;
      padding: 16px;
      border-radius: 18px;
      border: 1px solid var(--stroke);
      background: rgba(0,0,0,0.18);
    }
    .item .left{ min-width: 0; }
    .item .name{ font-size: 22px; font-weight: 850; margin: 0; }
    .item .name a{ color: inherit; text-decoration: none; transition: opacity 0.2s; }
    .item .name a:hover{ opacity: 0.8; text-decoration: underline; }
    .item .meta{ margin-top: 6px; color: var(--muted); font-weight: 650; line-height: 1.35; }
    .item .reason{ margin-top: 10px; color: rgba(255,255,255,0.82); line-height: 1.45; white-space: pre-wrap; }
    .badges{ margin-top: 10px; display:flex; flex-wrap: wrap; gap: 8px; }
    .badge{
      font-size: 12px;
      border: 1px solid rgba(255,255,255,0.12);
      background: rgba(0,0,0,0.18);
      color: rgba(255,255,255,0.80);
      padding: 6px 10px;
      border-radius: 999px;
    }
    .score{
      min-width: 82px;
      height: 48px;
      display:flex; align-items:center; justify-content:center;
      border-radius: 14px;
      border: 1px solid rgba(255,107,129,0.35);
      background: rgba(255,107,129,0.10);
      font-size: 24px;
      font-weight: 900;
      color: var(--red);
      flex: 0 0 auto;
    }
    .score.good{
      border-color: rgba(121,226,155,0.35);
      background: rgba(121,226,155,0.12);
      color: var(--green);
    }
    .score.mid{
      border-color: rgba(255,184,107,0.35);
      background: rgba(255,184,107,0.12);
      color: var(--orange);
    }

    .split{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
      margin-top: 12px;
    }
    @media (max-width: 980px){ .split{ grid-template-columns: 1fr; } }

    .hidden{ display:none; }
    .relaunch-subpanel{ margin-top: 20px; }
    .relaunch-subpanel.hidden{ display:none; }
    
    .table{
      width: 100%; border-collapse: collapse; margin-top: 12px;
    }
    .table th{
      text-align: left; padding: 10px; background: rgba(0,0,0,0.2);
      border-bottom: 1px solid var(--stroke); font-size: 12px; color: var(--muted);
      text-transform: uppercase;
    }
    .table td{
      padding: 10px; border-bottom: 1px solid rgba(255,255,255,0.05);
      font-size: 14px;
    }
    .table tr:hover{ background: rgba(255,255,255,0.03); }
    </style>
</head>

<body>
  <div class="wrap">
    <div class="hero">
      <h1 class="title">ü´ê Game Scout</h1>
      <div class="sub">–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞ –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–æ–Ω–Ω–æ–π –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ ‚Äî –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ç—Ä–µ–Ω–¥–æ–≤ –∏ —Ç–æ—á–µ–∫ –≤—Ö–æ–¥–∞</div>
        </div>

    <div class="tabs" id="tabs">
      <div class="tab active" data-tab="system" title="–û–±—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã –∏ –∂–∏–∑–Ω–µ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å –ø–∞–π–ø–ª–∞–π–Ω–∞ –¥–∞–Ω–Ω—ã—Ö">üìä –°–∏—Å—Ç–µ–º–∞</div>
      <div class="tab" data-tab="trends" title="–ò–≥—Ä—ã —Å –∞–Ω–æ–º–∞–ª—å–Ω—ã–º —Ä–æ—Å—Ç–æ–º –∏–Ω—Ç–µ—Ä–µ—Å–∞ –∏ –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–π –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–æ–Ω–Ω–æ–π –ø—Ä–∏–≤–ª–µ–∫–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é">üî• –¢—Ä–µ–Ω–¥—ã</div>
      <div class="tab" data-tab="sources" title="–ò—Å—Ç–æ—á–Ω–∏–∫–∏ –≤–Ω–µ—à–Ω–∏—Ö —Å–∏–≥–Ω–∞–ª–æ–≤, –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö –¥–ª—è –æ—Ü–µ–Ω–∫–∏ –∏–Ω—Ç–µ—Ä–µ—Å–∞ –∫ –∏–≥—Ä–∞–º">üß† –ò—Å—Ç–æ—á–Ω–∏–∫–∏ –¥–∞–Ω–Ω—ã—Ö</div>
      <div class="tab" data-tab="games" title="–ü–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫ –∏–≥—Ä, –∏–∑–≤–µ—Å—Ç–Ω—ã—Ö —Å–∏—Å—Ç–µ–º–µ">üóÇ –ë–∞–∑–∞ –∏–≥—Ä</div>
      <div class="tab" data-tab="relaunch" title="–ê–Ω–∞–ª–∏–∑ –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª–∞ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –∏–≥—Ä">üöÄ Relaunch Scout</div>
      <div class="tab" data-tab="actions" title="–†—É—á–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —ç—Ç–∞–ø–∞–º–∏ –ø–∞–π–ø–ª–∞–π–Ω–∞ –∏ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º">‚öôÔ∏è –î–µ–π—Å—Ç–≤–∏—è</div>
        </div>

        <!-- –°–∏—Å—Ç–µ–º–∞ -->
    <section class="panel" id="panel-system">
      <h2>üìä –°–∏—Å—Ç–µ–º–∞</h2>
      <div class="status" style="color: rgba(255,255,255,0.82); margin-bottom: 18px;">
        –û–±—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã –∏ –∂–∏–∑–Ω–µ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å –ø–∞–π–ø–ª–∞–π–Ω–∞ –¥–∞–Ω–Ω—ã—Ö
      </div>
      
      <!-- –°—Ç–∞—Ç—É—Å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ -->
      <div class="cards" id="system-status-cards"></div>
      
      <!-- –°—á–µ—Ç—á–∏–∫–∏ Trends Pipeline -->
      <h3 style="margin-top: 24px; font-size: 20px;">–¢—Ä–µ–Ω–¥—ã (—Å–µ–≥–æ–¥–Ω—è)</h3>
      <div class="cards" id="trends-pipeline-cards"></div>
      
      <!-- Freshness -->
      <h3 style="margin-top: 24px; font-size: 20px;">–°–≤–µ–∂–µ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö</h3>
      <div class="status" id="freshness-info">–ó–∞–≥—Ä—É–∑–∫–∞‚Ä¶</div>
      
      <div class="small" style="margin-top: 12px;">
        API: <code>/api/v1/admin/system/summary</code>
      </div>
    </section>

        <!-- –¢—Ä–µ–Ω–¥—ã -->
    <section class="panel hidden" id="panel-trends">
      <h2>üî• –¢—Ä–µ–Ω–¥—ã (Steam)</h2>
      <div class="status" style="color: rgba(255,255,255,0.82); margin-bottom: 18px;">
        –ò–≥—Ä—ã —Å –∞–Ω–æ–º–∞–ª—å–Ω—ã–º —Ä–æ—Å—Ç–æ–º –∏–Ω—Ç–µ—Ä–µ—Å–∞ –∏ –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–π –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–æ–Ω–Ω–æ–π –ø—Ä–∏–≤–ª–µ–∫–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é
      </div>
      
      <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
      <div class="cards" id="trends-stats-cards"></div>
      
      <!-- Top 20 Emerging -->
      <h3 style="margin-top: 24px; font-size: 20px;">–¢–æ–ø-20 Emerging Games</h3>
      
      <!-- –§–∏–ª—å—Ç—Ä—ã (Lifecycle Intelligence v5) -->
      <div class="filter" id="trends-filters" style="margin-top: 12px; display: none;">
        <div class="chip active" data-filter-lifecycle="all">–í—Å–µ —Ü–∏–∫–ª—ã</div>
        <div class="chip" data-filter-lifecycle="BREAKOUT">–ü—Ä–æ—Ä—ã–≤</div>
        <div class="chip" data-filter-lifecycle="GROWTH">–†–æ—Å—Ç</div>
        <div class="chip" data-filter-lifecycle="RELAUNCH_CANDIDATE">üîÅ –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫</div>
        <div class="chip" data-filter-confidence="high" style="margin-left: 12px;">üü¢ –í—ã—Å–æ–∫–∏–π confidence</div>
      </div>
      
      <div class="status" id="trends-emerging-status">–ó–∞–≥—Ä—É–∑–∫–∞‚Ä¶</div>
      <div id="trends-emerging-table"></div>
      
      <div class="small" style="margin-top: 12px;">
        API: <code>/api/v1/admin/system/summary</code>, <code>/api/v1/trends/games/emerging</code>
      </div>
    </section>

        <!-- –ò—Å—Ç–æ—á–Ω–∏–∫–∏ –¥–∞–Ω–Ω—ã—Ö -->
    <section class="panel hidden" id="panel-sources">
      <h2>üß† –ò—Å—Ç–æ—á–Ω–∏–∫–∏ –¥–∞–Ω–Ω—ã—Ö</h2>
      <div class="status" style="color: rgba(255,255,255,0.82); margin-bottom: 18px;">
        –ò—Å—Ç–æ—á–Ω–∏–∫–∏ –≤–Ω–µ—à–Ω–∏—Ö —Å–∏–≥–Ω–∞–ª–æ–≤, –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö –¥–ª—è –æ—Ü–µ–Ω–∫–∏ –∏–Ω—Ç–µ—Ä–µ—Å–∞ –∫ –∏–≥—Ä–∞–º
      </div>
      
      <div id="sources-list"></div>
      
      <div class="small" style="margin-top: 12px;">
        API: <code>/api/v1/admin/system/summary</code>, <code>/api/v1/youtube/health</code>, <code>/api/v1/reddit/health</code>
      </div>
    </section>

        <!-- Games -->
    <section class="panel hidden" id="panel-games">
      <h2>üóÇ –ë–∞–∑–∞ –∏–≥—Ä</h2>
      <div class="status" style="color: rgba(255,255,255,0.82); margin-bottom: 18px;">
        –ü–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫ –∏–≥—Ä, –∏–∑–≤–µ—Å—Ç–Ω—ã—Ö —Å–∏—Å—Ç–µ–º–µ
      </div>
      
      <div class="filter" style="margin-top: 12px;">
        <div class="chip active" data-games-filter="all">–í—Å–µ</div>
        <div class="chip" data-games-filter="with-reviews">–° –æ—Ç–∑—ã–≤–∞–º–∏</div>
        <div class="chip" data-games-filter="with-signals">–°–æ —Å–∏–≥–Ω–∞–ª–∞–º–∏</div>
        <div class="chip" data-games-filter="in-trends">–í —Ç—Ä–µ–Ω–¥–∞—Ö</div>
      </div>
      
      <div class="status" id="games-status">–ó–∞–≥—Ä—É–∑–∫–∞‚Ä¶</div>
      <div class="status" id="games-list" style="margin-top:12px; display:none;"></div>
      <div class="small">
        API: <code>/api/v1/games/health</code>, <code>/api/v1/games/list</code>
        </div>
    </section>

    <!-- Relaunch -->
    <section class="panel hidden" id="panel-relaunch">
      <h2>üöÄ Relaunch Scout ‚Äî Rebound Window Edition</h2>
      <div class="status" style="color: rgba(255,255,255,0.82);">
        <b>–ö–æ–Ω—Ü–µ–ø—Ü–∏—è:</b> –Ω–∞—Ö–æ–¥–∏–º –Ω–µ–¥–æ—Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∏–≥—Ä—ã –≤ <b>Rebound Window</b> (6-24 –º–µ—Å—è—Ü–∞ –ø–æ—Å–ª–µ —Ä–µ–ª–∏–∑–∞).<br/>
        <b>–ù–ï –∏—â–µ–º:</b> –Ω–æ–≤—ã–µ –∏–≥—Ä—ã, —Ç—Ä–µ–Ω–¥—ã, —Ö–∞–π–ø ‚Äî —ç—Ç–æ –¥–ª—è –¥—Ä—É–≥–∏—Ö –≤–∫–ª–∞–¥–æ–∫.<br/>
        <b>–ò—â–µ–º:</b> –∏–≥—Ä—ã, –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ –≤—ã—Å—Ç—Ä–µ–ª–∏–ª–∏, –Ω–æ –∏–º–µ—é—Ç –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª –¥–ª—è –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞.
            </div>

      <!-- –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –≤–∫–ª–∞–¥–∫–∏ Relaunch Scout -->
      <div class="tabs" style="margin-top: 20px; border-bottom: 1px solid var(--border);">
        <div class="tab active" data-subtab="scan">üîç Scan</div>
        <div class="tab" data-subtab="candidates">üìã Candidates</div>
        <div class="tab" data-subtab="diagnosis">üî¨ Diagnosis</div>
        <div class="tab" data-subtab="research">üìä Research</div>
        </div>

      <!-- –í–∫–ª–∞–¥–∫–∞ Scan -->
      <div class="relaunch-subpanel" id="relaunch-subpanel-scan">
        <div class="cards">
        <div class="kpi">
          <div class="label">Tracked apps</div>
          <div class="val" id="relaunch-tracked">-</div>
            </div>
        <div class="kpi">
          <div class="label">Candidates (all)</div>
          <div class="val green" id="relaunch-candidates">-</div>
        </div>
        <div class="kpi">
          <div class="label">Watchlist</div>
          <div class="val orange" id="relaunch-watchlist">-</div>
        </div>
        <div class="kpi">
          <div class="label">Rejected</div>
          <div class="val red" id="relaunch-rejected">-</div>
            </div>
        </div>

      <div class="split">
        <!-- –†—É—á–Ω–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ -->
        <div class="status">
          <b>1) –†—É—á–Ω–æ–π Track (—Ç–æ—á–µ—á–Ω–æ)</b>
          <div class="row" style="margin-top:10px;">
            <div class="group">
              <input id="relaunch-app-id" placeholder="Steam App ID (–Ω–∞–ø—Ä–∏–º–µ—Ä 1091500)" />
              <input id="relaunch-app-name" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –∏–≥—Ä—ã (–∫–∞–∫ —Ö–æ—á–µ—à—å –≤–∏–¥–µ—Ç—å)" />
              <input id="relaunch-track-priority" class="mini" placeholder="priority (0..100)" value="50" />
                </div>
            <button class="btn primary" id="btn-track">–î–æ–±–∞–≤–∏—Ç—å</button>
            <button class="btn" id="btn-refresh">–û–±–Ω–æ–≤–∏—Ç—å</button>
            </div>
          <div class="small">
            Endpoint: <code>POST /api/v1/relaunch/admin/track</code><br/>
            –°–æ–≤–µ—Ç: priority=50 ‚Äî –Ω–æ—Ä–º–∞–ª—å–Ω—ã–π –¥–µ—Ñ–æ–ª—Ç.
          </div>
          <div class="status" id="track-result" style="display:none; margin-top:10px;"></div>
        </div>

        <!-- Bulk –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ -->
        <div class="status">
          <b>2) Bulk Track (–º–∞—Å—Å–æ–≤–æ, –∫–∞–∫ –ø—Ä–æ–¥–∞–∫—à–Ω-–∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç)</b>
          <div class="row" style="margin-top:10px;">
            <div class="group">
              <input id="bulk-limit" class="mini" placeholder="limit" value="200" />
              <input id="bulk-min-reviews" class="mini" placeholder="min_reviews" value="200" />
              <input id="bulk-priority" class="mini" placeholder="priority (0..100)" value="50" />
                                    </div>
            <button class="btn primary" id="btn-bulk">Bulk Track</button>
            <button class="btn danger" id="btn-bulk-help">–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç?</button>
                                    </div>
          <div class="small">
            Endpoint: <code>POST /api/v1/relaunch/admin/bulk_track</code><br/>
            Bulk —Ä–µ–∂–∏–º –ù–ï —Ö–æ–¥–∏—Ç –≤ Steam. –û–Ω –≤—ã–±–∏—Ä–∞–µ—Ç –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤ –∏–∑ –ë–î (<code>steam_games</code> –∏–ª–∏ <code>games</code>).
                                </div>
          <div class="status" id="bulk-result" style="display:none; margin-top:10px;"></div>
            </div>
        </div>

      <div class="status" style="margin-top:12px;">
        <b>3) –°–∫–∞–Ω–∏—Ä–æ–≤–∞—Ç—å —Ä—ã–Ω–æ–∫ (Rebound Window)</b>
        <div class="row" style="margin-top:10px;">
          <div class="group">
            <input id="scan-limit" class="mini" placeholder="limit" value="200" />
            <input id="scan-min-reviews" class="mini" placeholder="min_reviews" value="50" />
            <input id="scan-max-reviews" class="mini" placeholder="max_reviews" value="5000" />
            <input id="scan-priority" class="mini" placeholder="priority (0..100)" value="50" />
          </div>
          <button class="btn primary" id="btn-scan-market">–°–∫–∞–Ω–∏—Ä–æ–≤–∞—Ç—å —Ä—ã–Ω–æ–∫</button>
        </div>
        <div class="small">
          Endpoint: <code>POST /api/v1/relaunch/admin/market_scan</code><br/>
          <b>Rebound Window:</b> –∏—â–µ—Ç –Ω–µ–¥–æ—Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∏–≥—Ä—ã 6-24 –º–µ—Å—è—Ü–∞ –ø–æ—Å–ª–µ —Ä–µ–ª–∏–∑–∞ (–ù–ï –Ω–æ–≤—ã–µ, –ù–ï —Ç—Ä–µ–Ω–¥—ã).<br/>
          –ö—Ä–∏—Ç–µ—Ä–∏–∏: reviews 50-5000, price > 0, –Ω–µ DLC/demo. –ü–∞—Ä—Å–∏—Ç Steam –Ω–∞–ø—Ä—è–º—É—é –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∫–∞—Ç–∞–ª–æ–≥ –ë–î.
        </div>
        <div class="status" id="scan-market-result" style="display:none; margin-top:10px;"></div>
    </div>

      </div> <!-- relaunch-subpanel-scan -->

      <!-- –í–∫–ª–∞–¥–∫–∞ Candidates -->
      <div class="relaunch-subpanel hidden" id="relaunch-subpanel-candidates">
        <div class="cards">
          <div class="kpi">
            <div class="label">Tracked apps</div>
            <div class="val" id="relaunch-tracked">-</div>
          </div>
          <div class="kpi">
            <div class="label">Candidates (all)</div>
            <div class="val green" id="relaunch-candidates">-</div>
          </div>
          <div class="kpi">
            <div class="label">Watchlist</div>
            <div class="val orange" id="relaunch-watchlist">-</div>
          </div>
          <div class="kpi">
            <div class="label">Rejected</div>
            <div class="val red" id="relaunch-rejected">-</div>
          </div>
        </div>

        <div class="filter" style="margin-top: 20px;">
          <div class="chip active" data-filter="all">–í—Å–µ</div>
          <div class="chip" data-filter="watchlist">Watchlist</div>
          <div class="chip" data-filter="rejected">Rejected</div>
        </div>

        <div class="list" id="relaunch-cards"></div>
      </div> <!-- relaunch-subpanel-candidates -->

      <!-- –í–∫–ª–∞–¥–∫–∞ Diagnosis -->
      <div class="relaunch-subpanel hidden" id="relaunch-subpanel-diagnosis">
        <div class="status">
          <b>–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–≤–∞–ª–∞ (Rule-based, –±–µ–∑ LLM)</b>
          <div class="row" style="margin-top:10px;">
            <input id="diagnose-limit" class="mini" placeholder="limit" value="50" />
            <button class="btn primary" id="btn-diagnose">–ó–∞–ø—É—Å—Ç–∏—Ç—å –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É</button>
          </div>
          <div class="small">
            Endpoint: <code>POST /api/v1/relaunch/admin/diagnose</code><br/>
            –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã–µ –∏–≥—Ä—ã –∏ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –ø—Ä–æ–≤–∞–ª–∞ + relaunch angles.
          </div>
          <div class="status" id="diagnose-result" style="display:none; margin-top:10px;"></div>
        </div>
        <div class="status" style="margin-top:20px;">
          <b>–ü–µ—Ä–µ—Å—á—ë—Ç Scores (–¥–ª—è –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤)</b>
          <div class="row" style="margin-top:10px;">
            <input id="compute-scores-limit" class="mini" placeholder="limit" value="200" />
            <button class="btn primary" id="btn-compute-scores">–ü–µ—Ä–µ—Å—á–∏—Ç–∞—Ç—å Scores</button>
          </div>
          <div class="small">
            Endpoint: <code>POST /api/v1/relaunch/admin/compute_scores</code><br/>
            –í—ã—á–∏—Å–ª—è–µ—Ç relaunch_score –¥–ª—è –∞–∫—Ç–∏–≤–Ω—ã—Ö –∏–≥—Ä –∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç classification.
          </div>
          <div class="status" id="compute-scores-result" style="display:none; margin-top:10px;"></div>
        </div>
      </div> <!-- relaunch-subpanel-diagnosis -->

      <!-- –í–∫–ª–∞–¥–∫–∞ Research -->
      <div class="relaunch-subpanel hidden" id="relaunch-subpanel-research">
        <div class="status">
          <b>Research (–∑–∞–≥–ª—É—à–∫–∞)</b>
          <div class="small" style="margin-top:10px;">
            –ó–¥–µ—Å—å –±—É–¥–µ—Ç –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–≤–∞–ª–∞ —á–µ—Ä–µ–∑ —Å–æ—Ü—Å–µ—Ç–∏ (YouTube/Reddit/TikTok).<br/>
            <b>–í–∞–∂–Ω–æ:</b> —ç—Ç–æ –ù–ï —Ç—Ä–µ–Ω–¥—ã, –∞ –∞–Ω–∞–ª–∏–∑ "–ø–æ—á–µ–º—É –∏–≥—Ä–∞ –Ω–µ –≤–∑–ª–µ—Ç–µ–ª–∞".<br/>
            –ü–æ–∫–∞ –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ.
                        </div>
        </div>
      </div> <!-- relaunch-subpanel-research -->

      <div class="status" id="relaunch-hint" style="display:none; margin-top:12px;">
        –ü–æ–¥—Å–∫–∞–∑–∫–∞: –µ—Å–ª–∏ —Å–ø–∏—Å–æ–∫ –ø—É—Å—Ç ‚Äî —Å–Ω–∞—á–∞–ª–∞ —Å–¥–µ–ª–∞–π <b>Bulk Track</b> (200+ –∏–≥—Ä), –ø–æ—Ç–æ–º –∑–∞–ø—É—Å–∫–∞–π worker/beat –∑–∞–¥–∞—á–∏ –¥–ª—è —Å–∫–æ—Ä–∏–Ω–≥–∞.
                                        </div>

      <div class="status" id="relaunch-error" style="display:none; border-color: rgba(255,107,129,0.35); color: rgba(255,255,255,0.85);">
        –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏
                                    </div>

      <div class="small">
        API: <code>/api/v1/relaunch/health</code>, <code>/api/v1/relaunch/candidates</code>,
        <code>/api/v1/relaunch/admin/track</code>, <code>/api/v1/relaunch/admin/bulk_track</code>,
        <code>/api/v1/relaunch/admin/market_scan</code>
                            </div>
    </section>

    <!-- –î–µ–π—Å—Ç–≤–∏—è -->
    <section class="panel hidden" id="panel-actions">
      <h2>‚öôÔ∏è –î–µ–π—Å—Ç–≤–∏—è / –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞</h2>
      <div class="status" style="color: rgba(255,255,255,0.82); margin-bottom: 18px;">
        –†—É—á–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —ç—Ç–∞–ø–∞–º–∏ –ø–∞–π–ø–ª–∞–π–Ω–∞ –∏ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º
      </div>
      
      <div class="row" style="margin-top: 12px;">
        <button class="btn" id="btn-action-seed">Seed Apps</button>
        <button class="btn" id="btn-action-collect">Collect Jobs</button>
        <button class="btn" id="btn-action-ingest">Ingest Reviews</button>
        <button class="btn" id="btn-action-aggregate">Aggregate</button>
        <button class="btn primary" id="btn-action-verify">–ó–∞–ø—É—Å—Ç–∏—Ç—å Pipeline</button>
      </div>
      
      <div class="status" id="action-result" style="display:none; margin-top: 12px;"></div>
      
      <h3 style="margin-top: 24px; font-size: 20px;">–ò—Å—Ç–æ—Ä–∏—è –¥–µ–π—Å—Ç–≤–∏–π</h3>
      <div class="status" id="action-log" style="max-height: 300px; overflow-y: auto; font-family: var(--mono); font-size: 12px;"></div>
      
      <div class="small" style="margin-top: 12px;">
        API: <code>POST /api/v1/admin/system/action</code>
      </div>
    </section>

<script>
  // ==========================================
  // –ö–æ–Ω—Ñ–∏–≥
  // ==========================================
  // –ë–∞–∑–æ–≤—ã–π –ø—Ä–µ—Ñ–∏–∫—Å API.
  // –í–ê–ñ–ù–û: –∑–¥–µ—Å—å /api/v1, –∞ –¥–∞–ª—å—à–µ –º—ã –¥–æ–±–∞–≤–ª—è–µ–º /analytics, /relaunch, –∏ —Ç.–¥.
  const API = "/api/v1";

  function qs(sel){ return document.querySelector(sel); }
  function qsa(sel){ return Array.from(document.querySelectorAll(sel)); }

  // ==========================================
  // –ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ –≤–∫–ª–∞–¥–∫–∞–º
  // ==========================================
  function switchTab(tab){
    if(!tab) {
      console.warn("switchTab called without tab parameter");
      return;
    }
    
    console.log(`Switching to tab: ${tab}`);
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—É—é –≤–∫–ª–∞–¥–∫—É
    qsa(".tab").forEach(t => {
      const isActive = t.dataset.tab === tab;
      t.classList.toggle("active", isActive);
    });
    
    // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ –ø–∞–Ω–µ–ª–∏
    qsa("section.panel").forEach(p => {
      p.classList.add("hidden");
    });
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω—É–∂–Ω—É—é –ø–∞–Ω–µ–ª—å
    const panel = qs(`#panel-${tab}`);
    if(panel) {
      panel.classList.remove("hidden");
      console.log(`Panel #panel-${tab} shown`);
    } else {
      console.error(`Panel #panel-${tab} not found!`);
    }

    // –õ–µ–Ω–∏–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞: –¥–µ—Ä–≥–∞–µ–º –±—ç–∫–µ–Ω–¥ —Ç–æ–ª—å–∫–æ –∫–æ–≥–¥–∞ –≤–∫–ª–∞–¥–∫–∞ –æ—Ç–∫—Ä—ã—Ç–∞
    try {
      if(tab === "system") {
        loadSystem();
      } else if(tab === "trends") {
        loadTrends();
      } else if(tab === "sources") {
        loadSources();
      } else if(tab === "games") {
        loadGames();
      } else if(tab === "relaunch") {
        loadRelaunch();
      } else if(tab === "actions") {
        loadActions();
      }
    } catch(e) {
      console.error(`Error loading tab ${tab}:`, e);
      showToast(`–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –≤–∫–ª–∞–¥–∫–∏ ${tab}: ${e.message}`, true);
    }
  }
  
  // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≤–∫–ª–∞–¥–æ–∫ –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ DOM
  function initTabs() {
    const tabs = qsa(".tab");
    if (tabs.length === 0) {
      console.warn("No tabs found, retrying...");
      setTimeout(initTabs, 100);
      return;
    }
    tabs.forEach(t => {
      if (t.dataset.tab) {
        t.addEventListener("click", () => switchTab(t.dataset.tab));
      }
    });
  }
  
  // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –≤–∫–ª–∞–¥–∫–∏ - –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ–º –≤—ã–∑–æ–≤ –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ DOM
  function initializeDashboard() {
    try {
      console.log("üöÄ Initializing dashboard...");
      
      // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –≤–∫–ª–∞–¥–æ–∫
      const tabs = qsa(".tab[data-tab]");
      console.log(`Found ${tabs.length} tabs`);
      
      if (tabs.length === 0) {
        console.error("‚ùå No tabs found! Retrying in 100ms...");
        setTimeout(initializeDashboard, 100);
        return;
      }
      
      // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –≤–∫–ª–∞–¥–æ–∫
      initTabs();
      
      // –ó–∞–≥—Ä—É–∂–∞–µ–º –ø–µ—Ä–≤—É—é –≤–∫–ª–∞–¥–∫—É (system) –µ—Å–ª–∏ –æ–Ω–∞ –∞–∫—Ç–∏–≤–Ω–∞
      const activeTab = qs(".tab.active");
      if (activeTab && activeTab.dataset.tab) {
        console.log(`‚úÖ Active tab found: ${activeTab.dataset.tab}`);
        switchTab(activeTab.dataset.tab);
      } else {
        // –ï—Å–ª–∏ –Ω–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ–π –≤–∫–ª–∞–¥–∫–∏, –∞–∫—Ç–∏–≤–∏—Ä—É–µ–º –ø–µ—Ä–≤—É—é
        const firstTab = tabs[0];
        if (firstTab && firstTab.dataset.tab) {
          console.log(`‚ö†Ô∏è No active tab, activating first: ${firstTab.dataset.tab}`);
          firstTab.classList.add("active");
          switchTab(firstTab.dataset.tab);
        } else {
          console.error("‚ùå No valid tabs found!");
        }
      }
    } catch(e) {
      console.error("‚ùå Error in initializeDashboard:", e);
      showToast(`–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏: ${e.message}`, true);
    }
  }
  
  // –ó–∞–ø—É—Å–∫–∞–µ–º –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ DOM
  if (document.readyState === 'loading') {
    console.log("‚è≥ DOM is loading, waiting for DOMContentLoaded...");
    document.addEventListener('DOMContentLoaded', initializeDashboard);
  } else {
    // DOM —É–∂–µ –∑–∞–≥—Ä—É–∂–µ–Ω
    console.log("‚úÖ DOM already loaded, initializing immediately...");
    initializeDashboard();
  }

  // ==========================================
  // –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–µ helpers
  // ==========================================
  async function jget(url, timeout = 10000){
    const controller = new AbortController();
    const timeoutId = setTimeout(() => controller.abort(), timeout);
    
    try {
      const res = await fetch(url, {
        headers: {"accept":"application/json"},
        signal: controller.signal
      });
      clearTimeout(timeoutId);
      
      if(!res.ok){
        const t = await res.text();
        throw new Error(`${res.status} ${res.statusText} ‚Äî ${t}`);
      }
      return await res.json();
    } catch(e) {
      clearTimeout(timeoutId);
      if (e.name === 'AbortError') {
        throw new Error(`Request timeout after ${timeout}ms`);
      }
      throw e;
    }
  }

  async function jpost(url, payload, timeout = 30000){
    const controller = new AbortController();
    const timeoutId = setTimeout(() => controller.abort(), timeout);
    
    try {
      const res = await fetch(url, {
        method: "POST",
        headers: {"content-type":"application/json", "accept":"application/json"},
        body: JSON.stringify(payload),
        signal: controller.signal
      });
      clearTimeout(timeoutId);
      
      const txt = await res.text();
      let data = null;
      try { data = txt ? JSON.parse(txt) : null; } catch(e) { data = {raw: txt}; }
      if(!res.ok){
        throw new Error(`${res.status} ${res.statusText} ‚Äî ${txt}`);
      }
      return data;
    } catch(e) {
      clearTimeout(timeoutId);
      if (e.name === 'AbortError') {
        throw new Error(`Request timeout after ${timeout}ms`);
      }
      throw e;
    }
  }

  function showBox(id, html, ok=true){
    const el = qs(id);
    if(!el) return;
    el.style.display = "block";
    el.style.borderColor = ok ? "rgba(121,226,155,0.30)" : "rgba(255,107,129,0.35)";
    el.style.color = ok ? "rgba(255,255,255,0.86)" : "rgba(255,255,255,0.86)";
    el.innerHTML = html;
  }

  function esc(s){
    return String(s ?? "").replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;");
  }

  function toggleWhyNow(id) {
    const el = document.getElementById(id);
    if (!el) return;
    
    // –ó–∞–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ –±–ª–æ–∫–∏
    document.querySelectorAll('[id^="why-now-"]').forEach(e => {
      if (e.id !== id) e.style.display = 'none';
    });
    
    // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º —Ç–µ–∫—É—â–∏–π
    if (el.style.display === 'none' || !el.style.display) {
      el.style.display = 'block';
      // –ü–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä—É–µ–º –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –∫–Ω–æ–ø–∫–∏
      const button = el.previousElementSibling;
      if (button) {
        const rect = button.getBoundingClientRect();
        el.style.left = rect.left + 'px';
        el.style.top = (rect.bottom + 4) + 'px';
      }
    } else {
      el.style.display = 'none';
    }
  }
  
  // –ó–∞–∫—Ä—ã–≤–∞–µ–º –±–ª–æ–∫–∏ –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ –∏—Ö
  document.addEventListener('click', (e) => {
    if (!e.target.closest('[id^="why-now-"]') && !e.target.closest('button[onclick*="toggleWhyNow"]')) {
      document.querySelectorAll('[id^="why-now-"]').forEach(el => el.style.display = 'none');
    }
  });

  function showToast(message, isError = false) {
    // –ü—Ä–æ—Å—Ç–æ–π toast –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
    const toast = document.createElement('div');
    toast.style.cssText = `
      position: fixed; top: 20px; right: 20px; z-index: 10000;
      padding: 12px 16px; border-radius: 8px;
      background: ${isError ? 'rgba(255,107,129,0.9)' : 'rgba(121,226,155,0.9)'};
      color: white; font-weight: 600; box-shadow: 0 4px 12px rgba(0,0,0,0.3);
      max-width: 400px; word-wrap: break-word;
    `;
    toast.textContent = message;
    document.body.appendChild(toast);
    setTimeout(() => toast.remove(), 5000);
  }

  // ==========================================
  // –°–∏—Å—Ç–µ–º–∞
  // ==========================================
  async function loadSystem(){
    const statusCards = qs("#system-status-cards");
    const pipelineCards = qs("#trends-pipeline-cards");
    const freshnessEl = qs("#freshness-info");
    
    if(!statusCards || !pipelineCards || !freshnessEl) return;
    
    try{
      statusCards.innerHTML = "<div class='status'>–ó–∞–≥—Ä—É–∑–∫–∞...</div>";
      pipelineCards.innerHTML = "";
      freshnessEl.textContent = "–ó–∞–≥—Ä—É–∑–∫–∞...";
      
      const summary = await jget(`${API}/admin/system/summary`).catch(() => null);
      
      if(!summary) {
        statusCards.innerHTML = "<div class='status' style='color: rgba(255,107,129,0.85);'>–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö</div>";
        return;
      }
      
      // –°—Ç–∞—Ç—É—Å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
      const health = summary.health || {};
      const apiOk = health.api?.status === "ok" || false;
      const dbOk = health.database?.status === "ok" || false;
      const workerStatus = health.worker?.status || "unknown";
      const workerHint = health.worker?.hint || "";
      
      statusCards.innerHTML = `
        <div class="kpi ${apiOk ? '' : 'val red'}">
          <div class="label">API</div>
          <div class="val ${apiOk ? 'green' : 'red'}">${apiOk ? 'OK' : 'FAIL'}</div>
        </div>
        <div class="kpi">
          <div class="label">–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö</div>
          <div class="val ${dbOk ? 'green' : 'red'}">${dbOk ? 'OK' : 'FAIL'}</div>
        </div>
        <div class="kpi">
          <div class="label">Worker</div>
          <div class="val ${workerStatus === 'ok' ? 'green' : workerStatus === 'unknown' ? 'orange' : 'red'}">${workerStatus.toUpperCase()}</div>
          ${workerHint ? `<div style="font-size: 11px; margin-top: 4px; color: var(--muted);">${esc(workerHint)}</div>` : ''}
        </div>
      `;
      
      // Trends Pipeline Today
      const tt = summary.trends_today || {};
      pipelineCards.innerHTML = `
        <div class="kpi">
          <div class="label">Seed Apps</div>
          <div class="val">${tt.seed_apps || 0}</div>
        </div>
        <div class="kpi">
          <div class="label">Reviews (—Å–µ–≥–æ–¥–Ω—è)</div>
          <div class="val">${tt.reviews_count || 0}</div>
        </div>
        <div class="kpi">
          <div class="label">Jobs</div>
          <div class="val">${tt.jobs_queued || 0}</div>
        </div>
        <div class="kpi">
          <div class="label">Game Daily</div>
          <div class="val">${tt.trends_game_daily || 0}</div>
        </div>
        <div class="kpi">
          <div class="label">Emerging</div>
          <div class="val green">${tt.emerging_count || 0}</div>
        </div>
      `;
      
      // Jobs breakdown
      if(tt.jobs && tt.jobs.length > 0) {
        const jobsHtml = tt.jobs.map(j => `
          <div style="padding: 8px; border-bottom: 1px solid rgba(255,255,255,0.05);">
            <strong>${esc(j.job_type)}</strong>: ${esc(j.status)} = ${j.cnt}
          </div>
        `).join("");
        pipelineCards.innerHTML += `<div class="status" style="margin-top: 12px;"><strong>Jobs:</strong><div style="margin-top: 8px;">${jobsHtml}</div></div>`;
      }
      
      // Freshness
      const f = summary.freshness || {};
      const freshnessItems = [
        ['steam_app_facts_max_fetched_at', 'App Facts'],
        ['steam_review_daily_max_computed_at', 'Review Daily'],
        ['trend_jobs_max_updated_at', 'Trend Jobs'],
        ['trends_game_daily_max_day', 'Game Daily (Day)']
      ];
      
      freshnessEl.innerHTML = freshnessItems.map(([key, label]) => {
        const value = f[key];
        return `<div style="padding: 6px 0; border-bottom: 1px solid rgba(255,255,255,0.05);">
          <strong>${esc(label)}</strong>: ${value ? new Date(value).toLocaleString('ru-RU') : 'N/A'}
        </div>`;
      }).join("");
      
    }catch(e){
      if(statusCards) statusCards.innerHTML = `<div class='status' style='color: rgba(255,107,129,0.85);'>–û—à–∏–±–∫–∞: ${esc(e.message)}</div>`;
      if(freshnessEl) freshnessEl.textContent = `–û—à–∏–±–∫–∞: ${esc(e.message)}`;
    }
  }

  // ==========================================
  // –¢—Ä–µ–Ω–¥—ã
  // ==========================================
  async function loadTrends(){
    const statsCards = qs("#trends-stats-cards");
    const emergingStatus = qs("#trends-emerging-status");
    const emergingTable = qs("#trends-emerging-table");
    
    if(!statsCards || !emergingStatus || !emergingTable) return;
    
    try{
      emergingStatus.textContent = "–ó–∞–≥—Ä—É–∑–∫–∞...";
      emergingTable.innerHTML = "";
      
      const summary = await jget(`${API}/admin/system/summary`).catch(() => null);
      
      if(!summary) {
        emergingStatus.textContent = "–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö";
        emergingStatus.style.color = "rgba(255,107,129,0.85)";
        return;
      }
      
      const tt = summary.trends_today || {};
      const diag = summary.diagnostics || {};
      
      // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
      statsCards.innerHTML = `
        <div class="kpi">
          <div class="label">Emerging –Ω–∞–π–¥–µ–Ω–æ</div>
          <div class="val green">${tt.emerging_count || 0}</div>
        </div>
        <div class="kpi">
          <div class="label">–ë–µ–∑ —Å–∏–≥–Ω–∞–ª–æ–≤</div>
          <div class="val orange">${diag.seeds_missing_numeric_signals || 0}</div>
        </div>
        <div class="kpi">
          <div class="label">–ò—Å–∫–ª—é—á–µ–Ω–æ (evergreen)</div>
          <div class="val red">${diag.filtered_evergreen_giants || 0}</div>
        </div>
      `;
      
      // Top 20 Emerging - –∏—Å–ø–æ–ª—å–∑—É–µ–º –ø—Ä—è–º–æ–π –≤—ã–∑–æ–≤ API –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ–ª–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞
      try {
        const emergingData = await jget(`${API}/trends/games/emerging?limit=20`).catch(err => {
          console.error("Emerging API error:", err);
          return { games: [] };
        });
        const top20 = emergingData.games || [];
        
        // Engine v5: –í—ã—á–∏—Å–ª—è–µ–º —Ä–µ–∞–ª—å–Ω–æ–µ –≤–ª–∏—è–Ω–∏–µ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –Ω–∞ –æ—Å–Ω–æ–≤–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
        let redditInfluence = 0;
        let youtubeInfluence = 0;
        let steamInfluence = 0;
        let gamesWithReddit = 0;
        let gamesWithYouTube = 0;
        let gamesWithSteam = 0;
        
        top20.forEach(g => {
          const components = g.score_components || {};
          const redditComp = components.reddit_component || 0;
          const youtubeComp = components.youtube_component || 0;
          const confirmationComp = components.score_confirmation || 0;
          
          if (redditComp > 0) {
            redditInfluence += redditComp;
            gamesWithReddit++;
          } else if (redditComp < 0) {
            // Anti-hype: –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç —Ç–æ–∂–µ —Å—á–∏—Ç–∞–µ—Ç—Å—è –≤–ª–∏—è–Ω–∏–µ–º
            redditInfluence += Math.abs(redditComp);
            gamesWithReddit++;
          }
          
          if (youtubeComp > 0) {
            youtubeInfluence += youtubeComp;
            gamesWithYouTube++;
          } else if (youtubeComp < 0) {
            youtubeInfluence += Math.abs(youtubeComp);
            gamesWithYouTube++;
          }
          
          if (confirmationComp > 0) {
            steamInfluence += confirmationComp;
            gamesWithSteam++;
          }
        });
        
        const totalInfluence = redditInfluence + youtubeInfluence + steamInfluence;
        const redditPct = totalInfluence > 0 ? Math.round((redditInfluence / totalInfluence) * 100) : 0;
        const youtubePct = totalInfluence > 0 ? Math.round((youtubeInfluence / totalInfluence) * 100) : 0;
        const steamPct = totalInfluence > 0 ? Math.round((steamInfluence / totalInfluence) * 100) : 0;
        
        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ loadSources
        window.emergingInfluenceData = {
          games_found: top20.length,
          reddit_pct: redditPct,
          youtube_pct: youtubePct,
          steam_pct: steamPct,
          games_with_reddit: gamesWithReddit,
          games_with_youtube: gamesWithYouTube,
          games_with_steam: gamesWithSteam,
          total_influence: totalInfluence
        };
        
        if(top20.length === 0) {
          emergingStatus.innerHTML = `
            <div style="padding: 40px; text-align: center; color: var(--muted);">
              <h3 style="color: var(--orange); margin-bottom: 8px;">–ù–µ—Ç Emerging Games</h3>
              <p>–í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:</p>
              <ul style="text-align: left; display: inline-block; margin-top: 12px;">
                <li>–û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç —á–∏—Å–ª–æ–≤—ã–µ —Å–∏–≥–Ω–∞–ª—ã: ${diag.seeds_missing_numeric_signals || 0} –∏–≥—Ä</li>
                <li>–û—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω—ã –∫–∞–∫ evergreen giants: ${diag.filtered_evergreen_giants || 0} –∏–≥—Ä</li>
              </ul>
            </div>
          `;
          emergingTable.innerHTML = "";
        } else {
          emergingStatus.textContent = `–ù–∞–π–¥–µ–Ω–æ ${top20.length} –∏–≥—Ä`;
          
          // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ñ–∏–ª—å—Ç—Ä—ã
          const filtersEl = qs("#trends-filters");
          if (filtersEl) filtersEl.style.display = "flex";
          
          emergingTable.innerHTML = `
            <table class="table" style="margin-top: 12px;">
              <thead>
                <tr>
                  <th>–†–∞–Ω–≥</th>
                  <th>–ò–≥—Ä–∞</th>
                  <th>–í–µ—Ä–¥–∏–∫—Ç</th>
                  <th>–ë–∞–ª–ª</th>
                  <th>–£–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å</th>
                  <th>–°—Ç–∞–¥–∏—è</th>
                  <th>–ñ–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª</th>
                  <th>–¢–∏–ø —Ä–æ—Å—Ç–∞</th>
                  <th>–ò—Å—Ç–æ—á–Ω–∏–∫–∏</th>
                  <th>–°—Å—ã–ª–∫–∏</th>
                  <th>–û—Ç–∑—ã–≤—ã</th>
                  <th>Œî 7 –¥–Ω–µ–π</th>
                  <th>–ü–æ—á–µ–º—É —Å–µ–π—á–∞—Å</th>
                </tr>
              </thead>
              <tbody>
                ${top20.map((g, idx) => {
                  // –ü–µ—Ä–µ–≤–æ–¥ Verdict
                  const verdictRaw = g.verdict || '';
                  let verdict = verdictRaw;
                  let verdictColor = 'var(--muted)';
                  
                  if (verdictRaw.includes('Strong') || verdictRaw.includes('organic')) {
                    verdict = '–°–∏–ª—å–Ω—ã–π —Å–∏–≥–Ω–∞–ª';
                    verdictColor = 'var(--green)';
                  } else if (verdictRaw.includes('Hype') || verdictRaw.includes('spike')) {
                    verdict = '–•–∞–π–ø-–≤—Å–ø–ª–µ—Å–∫';
                    verdictColor = 'var(--orange)';
                  } else if (verdictRaw.includes('Weak') || verdictRaw.includes('Limited')) {
                    verdict = '–°–ª–∞–±—ã–π —Å–∏–≥–Ω–∞–ª';
                    verdictColor = 'var(--muted)';
                  } else if (verdictRaw.includes('Early')) {
                    verdict = '–†–∞–Ω–Ω–∏–π —Å–∏–≥–Ω–∞–ª';
                    verdictColor = 'var(--orange)';
                  } else if (verdictRaw.includes('Moderate') || verdictRaw.includes('Promising')) {
                    verdict = '–£–º–µ—Ä–µ–Ω–Ω—ã–π —Ä–æ—Å—Ç';
                    verdictColor = 'var(--blue)';
                  } else if (verdictRaw) {
                    verdict = verdictRaw; // –û—Å—Ç–∞–≤–ª—è–µ–º –∫–∞–∫ –µ—Å—Ç—å –µ—Å–ª–∏ –Ω–µ —Ä–∞—Å–ø–æ–∑–Ω–∞–ª–∏
                  } else {
                    verdict = '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö';
                  }
                  
                  // –§–æ—Ä–º–∏—Ä—É–µ–º –Ω–∞–∑–≤–∞–Ω–∏–µ –∏ —Å—Å—ã–ª–∫—É (–∏—Å–ø–æ–ª—å–∑—É–µ–º game_name –∏–∑ API)
                  const steamUrl = g.steam_url || `https://store.steampowered.com/app/${g.steam_app_id}/`;
                  let displayName = (g.game_name || g.name);
                  const isUnknown = !displayName || !displayName.trim() || displayName.includes('Unknown') || displayName.includes('App #');
                  
                  if (isUnknown) {
                    displayName = `Unknown Game (#${g.steam_app_id})`;
                  }
                  
                  // Brain v3 fields
                  const confidenceScore = g.confidence_score || 0;
                  const confidenceLevelRaw = g.confidence_level || 'LOW';
                  
                  // –ü–µ—Ä–µ–≤–æ–¥ Confidence (–∏—Å–ø–æ–ª—å–∑—É–µ–º —É–∂–µ –ø–µ—Ä–µ–≤–µ–¥—ë–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –∏–∑ API)
                  let confidenceLevel = confidenceLevelRaw; // API —É–∂–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –Ω–∞ —Ä—É—Å—Å–∫–æ–º
                  let confidenceColor = 'var(--muted)';
                  if (confidenceLevelRaw === '–í—ã—Å–æ–∫–∞—è' || confidenceLevelRaw === 'HIGH') {
                    confidenceColor = 'var(--green)';
                  } else if (confidenceLevelRaw === '–°—Ä–µ–¥–Ω—è—è' || confidenceLevelRaw === 'MEDIUM') {
                    confidenceColor = 'var(--orange)';
                  }
                  
                  // Stage (–∏—Å–ø–æ–ª—å–∑—É–µ–º —É–∂–µ –ø–µ—Ä–µ–≤–µ–¥—ë–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –∏–∑ API)
                  const stage = g.stage || '–®—É–º';
                  let stageColor = 'var(--muted)';
                  if (stage.includes('–ü—Ä–æ—Ä—ã–≤')) {
                    stageColor = 'var(--green)';
                  } else if (stage.includes('–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ')) {
                    stageColor = 'var(--blue)';
                  } else if (stage.includes('–†–∞–Ω–Ω–∏–π')) {
                    stageColor = 'var(--orange)';
                  }
                  
                  // Lifecycle Intelligence v5
                  const lifecycleStage = g.lifecycle_stage || '–ó—Ä–µ–ª–æ—Å—Ç—å';
                  let lifecycleColor = 'var(--muted)';
                  let lifecycleIcon = '';
                  if (lifecycleStage.includes('–ü—Ä–æ—Ä—ã–≤')) {
                    lifecycleColor = 'var(--green)';
                  } else if (lifecycleStage.includes('–†–æ—Å—Ç')) {
                    lifecycleColor = 'var(--blue)';
                  } else if (lifecycleStage.includes('–ö–∞–Ω–¥–∏–¥–∞—Ç –Ω–∞ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫')) {
                    lifecycleColor = 'var(--orange)';
                    lifecycleIcon = 'üîÅ ';
                  } else if (lifecycleStage.includes('–°–ø–∞–¥')) {
                    lifecycleColor = 'var(--red)';
                  }
                  
                  // Anti-Hype Layer v5: –¢–∏–ø —Ä–æ—Å—Ç–∞
                  const growthType = g.growth_type || '–û—Ä–≥–∞–Ω–∏—á–µ—Å–∫–∏–π';
                  let growthTypeColor = 'var(--green)';
                  let growthTypeTooltip = '–†–æ—Å—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥—ë–Ω –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º–∏';
                  if (growthType.includes('–•–∞–π–ø')) {
                    growthTypeColor = 'var(--orange)';
                    growthTypeTooltip = '–†–∏—Å–∫ —Ö–∞–π–ø–∞: —Ä–æ—Å—Ç —Ç–æ–ª—å–∫–æ –≤ —Å–æ—Ü–∏–∞–ª—å–Ω—ã—Ö —Å–µ—Ç—è—Ö –±–µ–∑ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è Steam';
                  } else if (growthType.includes('–ù–æ–≤–æ—Å—Ç–Ω–æ–π')) {
                    growthTypeColor = 'var(--blue)';
                    growthTypeTooltip = '–†–æ—Å—Ç –Ω–∞ –Ω–æ–≤–æ—Å—Ç—è—Ö: –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≤ Steam';
                  } else if (growthType.includes('–ü–ª–∞—Ç—Ñ–æ—Ä–º–µ–Ω–Ω—ã–π')) {
                    growthTypeColor = 'var(--muted)';
                    growthTypeTooltip = '–†–æ—Å—Ç —Ç–æ–ª—å–∫–æ –≤ Steam, –±–µ–∑ –≤–Ω–µ—à–Ω–∏—Ö —Å–∏–≥–Ω–∞–ª–æ–≤';
                  } else if (growthType.includes('–°–º–µ—à–∞–Ω–Ω—ã–π')) {
                    growthTypeColor = 'var(--green)';
                    growthTypeTooltip = '–ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω—ã';
                  }
                  
                  // WHY NOW v2
                  const whyNowV2 = g.why_now_v2 || null;
                  const whyNow = g.why_now || '–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞';
                  const signalsUsed = g.signals_used || [];
                  
                  // Final rank score (v5: confidence –∫–∞–∫ —Ñ–∞–∫—Ç–æ—Ä)
                  const finalRankScore = g.final_rank_score || g.emerging_score || 0;
                  
                  // Signals badges
                  const signalsBadges = signalsUsed.map(s => {
                    if (s === 'steam_reviews') return '<span style="background: rgba(110,168,255,0.2); padding: 2px 6px; border-radius: 3px; font-size: 10px;">Steam</span>';
                    if (s === 'reddit') return '<span style="background: rgba(255,184,107,0.2); padding: 2px 6px; border-radius: 3px; font-size: 10px;">Reddit</span>';
                    if (s === 'youtube') return '<span style="background: rgba(255,107,129,0.2); padding: 2px 6px; border-radius: 3px; font-size: 10px;">YouTube</span>';
                    if (s === 'steam_news') return '<span style="background: rgba(110,255,184,0.2); padding: 2px 6px; border-radius: 3px; font-size: 10px;">News</span>';
                    return '';
                  }).join(' ');
                  
                  // Engine v4: Evidence links
                  const evidence = g.evidence || [];
                  const evidenceLinks = evidence.slice(0, 3).map(ev => {
                    const sourceIcon = ev.source === 'steam_news' ? 'üì∞' : 
                                     ev.source === 'reddit' ? 'üí¨' : 
                                     ev.source === 'youtube' ? 'üé•' : 'üîó';
                    const title = ev.title || '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è';
                    const url = ev.url || '#';
                    return `<a href="${esc(url)}" target="_blank" rel="noopener noreferrer" title="${esc(title)}" style="text-decoration: none; margin: 0 2px; font-size: 14px;">${sourceIcon}</a>`;
                  }).join('');
                  
                  const evidenceTooltip = evidence.length > 0 ? 
                    evidence.map(ev => `${ev.source}: ${ev.title || '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è'}`).join('\\n') : 
                    '–ù–µ—Ç —Å—Å—ã–ª–æ–∫';
                  
                  // WHY NOW v2: –∫–Ω–æ–ø–∫–∞ —Å —Ä–∞—Å–∫—Ä—ã–≤–∞—é—â–∏–º—Å—è –±–ª–æ–∫–æ–º
                  const whyNowV2Id = `why-now-${g.steam_app_id}-${idx}`;
                  let whyNowButton = '';
                  let whyNowContent = '';
                  
                  if (whyNowV2 && whyNowV2.–æ—Å–Ω–æ–≤–Ω–æ–π_—Ç—Ä–∏–≥–≥–µ—Ä) {
                    whyNowButton = `<button onclick="toggleWhyNow('${whyNowV2Id}')" style="background: rgba(110,168,255,0.2); border: 1px solid rgba(110,168,255,0.3); color: var(--blue); padding: 4px 8px; border-radius: 4px; cursor: pointer; font-size: 11px; white-space: nowrap;">–ü–æ—á–µ–º—É —Å–µ–π—á–∞—Å?</button>`;
                    whyNowContent = `
                      <div id="${whyNowV2Id}" style="display: none; position: fixed; background: var(--panel); border: 1px solid var(--stroke); border-radius: 8px; padding: 12px; z-index: 10000; max-width: 400px; box-shadow: 0 4px 12px rgba(0,0,0,0.5); margin-top: 4px;">
                        <div style="font-weight: 600; margin-bottom: 8px; color: var(--blue);">${esc(whyNowV2.–æ—Å–Ω–æ–≤–Ω–æ–π_—Ç—Ä–∏–≥–≥–µ—Ä || '')}</div>
                        ${whyNowV2.–¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ_—Ñ–∞–∫—Ç–æ—Ä—ã && whyNowV2.–¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ_—Ñ–∞–∫—Ç–æ—Ä—ã.length > 0 ? `
                          <div style="margin-top: 8px; font-size: 12px;">
                            <div style="color: var(--muted); margin-bottom: 4px;">–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ñ–∞–∫—Ç–æ—Ä—ã:</div>
                            ${whyNowV2.–¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ_—Ñ–∞–∫—Ç–æ—Ä—ã.map(f => `<div style="margin-left: 8px; margin-top: 2px;">‚Ä¢ ${esc(f)}</div>`).join('')}
                          </div>
                        ` : ''}
                        ${whyNowV2.–∞–Ω–æ–º–∞–ª–∏—è ? `<div style="margin-top: 8px; font-size: 12px; color: var(--orange);">‚ö†Ô∏è ${esc(whyNowV2.–∞–Ω–æ–º–∞–ª–∏—è)}</div>` : ''}
                        ${whyNowV2.—Ä–∏—Å–∫–∏ ? `<div style="margin-top: 8px; font-size: 12px; color: var(--red);">‚ö†Ô∏è –†–∏—Å–∫–∏: ${esc(whyNowV2.—Ä–∏—Å–∫–∏)}</div>` : ''}
                        ${whyNowV2.–∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–æ–Ω–Ω–æ–µ_–æ–∫–Ω–æ_–¥–Ω–µ–π > 0 ? `<div style="margin-top: 8px; font-size: 11px; color: var(--muted);">‚è± –û–∫–Ω–æ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π: ${whyNowV2.–∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–æ–Ω–Ω–æ–µ_–æ–∫–Ω–æ_–¥–Ω–µ–π} –¥–Ω–µ–π</div>` : ''}
                      </div>
                    `;
                  } else {
                    whyNowButton = `<span style="font-size: 11px; color: var(--muted);" title="${esc(whyNow)}">${esc(whyNow.length > 50 ? whyNow.substring(0, 50) + '...' : whyNow)}</span>`;
                  }
                  
                  // –¶–≤–µ—Ç –∫–∞—Ä—Ç–æ—á–∫–∏ –ø–æ confidence (v5)
                  let rowBgColor = '';
                  if (confidenceScore >= 70) {
                    rowBgColor = 'rgba(121,226,155,0.05)'; // –ó–µ–ª—ë–Ω—ã–π –¥–ª—è –≤—ã—Å–æ–∫–æ–≥–æ confidence
                  } else if (confidenceScore >= 40) {
                    rowBgColor = 'rgba(255,184,107,0.05)'; // –û—Ä–∞–Ω–∂–µ–≤—ã–π –¥–ª—è —Å—Ä–µ–¥–Ω–µ–≥–æ
                  } else {
                    rowBgColor = 'rgba(255,107,129,0.05)'; // –ö—Ä–∞—Å–Ω—ã–π –¥–ª—è –Ω–∏–∑–∫–æ–≥–æ
                  }
                  
                  return `
                    <tr style="background: ${rowBgColor};" data-lifecycle-stage="${g.lifecycle_stage_raw || ''}" data-confidence-level="${g.confidence_level_raw || ''}">
                      <td>${idx + 1}</td>
                      <td>
                        ${isUnknown ? '<span style="color: var(--orange);">‚ö†Ô∏è</span> ' : ''}
                        <a href="${esc(steamUrl)}" target="_blank" rel="noopener noreferrer" style="color: var(--blue); text-decoration: underline; text-decoration-color: rgba(110,168,255,0.5); transition: text-decoration-color 0.2s;" onmouseover="this.style.textDecorationColor='var(--blue)'" onmouseout="this.style.textDecorationColor='rgba(110,168,255,0.5)'">${esc(displayName.replace(/\(#\d+\)/g, '').trim())}</a>
                        <span style="color: var(--muted); font-size: 11px; margin-left: 6px;">(#${g.steam_app_id || ''})</span>
                      </td>
                      <td style="color: ${verdictColor}; font-weight: 600; font-size: 12px;">${esc(verdict)}</td>
                      <td>
                        <strong>${finalRankScore.toFixed(1)}</strong>
                        ${finalRankScore !== (g.emerging_score || 0) ? `<div style="font-size: 9px; color: var(--muted);">(${(g.emerging_score || 0).toFixed(1)})</div>` : ''}
                      </td>
                      <td style="color: ${confidenceColor}; font-size: 12px;">
                        <div>${esc(confidenceLevel)}</div>
                        <div style="font-size: 10px; color: var(--muted);">${confidenceScore.toFixed(0)}</div>
                      </td>
                      <td style="color: ${stageColor}; font-size: 12px; font-weight: 600;">${esc(stage)}</td>
                      <td style="color: ${lifecycleColor}; font-size: 11px; font-weight: 600;">
                        ${lifecycleIcon}${esc(lifecycleStage)}
                      </td>
                      <td title="${esc(growthTypeTooltip)}" style="font-size: 11px;">
                        <span style="background: ${growthTypeColor}20; color: ${growthTypeColor}; padding: 2px 6px; border-radius: 3px; border: 1px solid ${growthTypeColor}40;">${esc(growthType)}</span>
                      </td>
                      <td style="font-size: 11px;">${signalsBadges || '<span style="color: var(--muted);">‚Äî</span>'}</td>
                      <td title="${esc(evidenceTooltip)}" style="font-size: 14px; text-align: center;">${evidenceLinks || '<span style="color: var(--muted);">‚Äî</span>'}</td>
                      <td>${g.reviews_total || '‚Äî'}</td>
                      <td>${g.reviews_delta_7d || '‚Äî'}</td>
                      <td style="font-size: 11px; position: relative;">
                        ${whyNowButton}
                        ${whyNowContent}
                      </td>
                    </tr>
                  `;
                }).join("")}
              </tbody>
            </table>
          `;
        }
      } catch(e) {
        emergingStatus.textContent = `–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: ${esc(e.message)}`;
        emergingStatus.style.color = "rgba(255,107,129,0.85)";
      }
      
    }catch(e){
      emergingStatus.textContent = `–û—à–∏–±–∫–∞: ${esc(e.message)}`;
      emergingStatus.style.color = "rgba(255,107,129,0.85)";
    }
  }

  // ==========================================
  // –ò—Å—Ç–æ—á–Ω–∏–∫–∏ –¥–∞–Ω–Ω—ã—Ö (–°–µ–Ω—Å–æ—Ä—ã —Å–∏—Å—Ç–µ–º—ã)
  // ==========================================
  async function loadSources(){
    const sourcesList = qs("#sources-list");
    if(!sourcesList) return;
    
    try{
      sourcesList.innerHTML = "<div class='status'>–ó–∞–≥—Ä—É–∑–∫–∞...</div>";
      
      const summary = await jget(`${API}/admin/system/summary`).catch(() => null);
      const youtubeHealth = await jget(`${API}/youtube/health`).catch(() => null);
      const redditHealth = await jget(`${API}/reddit/health`).catch(() => null);
      
      // –ë–µ–∑–æ–ø–∞—Å–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ summary.trends_today
      const tt = (summary && summary.trends_today) ? summary.trends_today : {};
      const signals = tt.signals_numeric || [];
      const emergingInfluence = tt.emerging_influence || {};
      const blindSpots = tt.blind_spots || [];
      
      // –ë–µ–∑–æ–ø–∞—Å–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ signalsCoverage –∏ signalsFreshness
      const signalsCoverage = tt.signals_coverage || {
        steam_reviews: {apps_with_signals: 0, signals_total: 0, total_apps: 0, pct: 0, active: false},
        steam_store: {apps_with_signals: 0, signals_total: 0, total_apps: 0, pct: 0, active: false},
        reddit: {apps_with_signals: 0, signals_total: 0, total_apps: 0, pct: 0, active: false},
        youtube: {apps_with_signals: 0, signals_total: 0, total_apps: 0, pct: 0, active: false}
      };
      const signalsFreshness = tt.signals_freshness || {
        steam_reviews: {last_captured_at: null, age_minutes: null},
        steam_store: {last_captured_at: null, age_minutes: null},
        reddit: {last_captured_at: null, age_minutes: null},
        youtube: {last_captured_at: null, age_minutes: null}
      };
      
      let html = '';
      
      // 1. –ë–ª–æ–∫ "–†–æ–ª—å –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤"
      html += `
        <div style="background: rgba(110,168,255,0.1); border-left: 3px solid var(--blue); padding: 16px; margin-bottom: 24px; border-radius: 4px;">
          <h3 style="margin: 0 0 8px 0; font-size: 18px; color: var(--blue);">üß† –†–æ–ª—å –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –¥–∞–Ω–Ω—ã—Ö</h3>
          <p style="margin: 0; color: var(--text); line-height: 1.6; font-size: 14px;">
            –≠—Ç–∞ –≤–∫–ª–∞–¥–∫–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç, –∫–∞–∫–∏–µ –≤–Ω–µ—à–Ω–∏–µ —Å–∏–≥–Ω–∞–ª—ã –ø–∏—Ç–∞—é—Ç –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–π –¥–≤–∏–∂–æ–∫ Game Scout.
            –ö–∞–∂–¥—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ –æ—Ç–¥–µ–ª—å–Ω—ã–π —Ç–∏–ø –∏–Ω—Ç–µ—Ä–µ—Å–∞: –ø–æ–≤–µ–¥–µ–Ω—á–µ—Å–∫–∏–π, —Å–æ—Ü–∏–∞–ª—å–Ω—ã–π –∏–ª–∏ –º–µ–¥–∏–π–Ω—ã–π.
            –ó–¥–µ—Å—å –≤—ã –≤–∏–¥–∏—Ç–µ –Ω–µ —Ç–æ–ª—å–∫–æ —Å—Ç–∞—Ç—É—Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è, –Ω–æ –∏ —Ä–µ–∞–ª—å–Ω—ã–π –≤–∫–ª–∞–¥ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –≤ –ø–æ–∏—Å–∫ emerging-–∏–≥—Ä.
          </p>
        </div>
      `;
      
      // 2. –£–º–Ω—ã–µ –∫–∞—Ä—Ç–æ—á–∫–∏ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤
      html += '<div class="cards" style="margin-bottom: 24px;">';
      
      // Steam Reviews - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –∞–∫—Ç–∏–≤–µ–Ω
      const steamReviewsCoverage = signalsCoverage.steam_reviews || {apps_with_signals: 0, total_apps: 0, pct: 0, active: false};
      const steamReviewsActive = steamReviewsCoverage.active;
      const steamReviewsFreshness = signalsFreshness.steam_reviews || {last_captured_at: null, age_minutes: null};
      
      if (steamReviewsActive) {
        html += `
          <div class="kpi" style="min-height: 200px;" title="–û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –æ—Ü–µ–Ω–∫–∏ –º–∞—Å—à—Ç–∞–±–∞ –∏–≥—Ä—ã, –∫–∞—á–µ—Å—Ç–≤–∞ –∞—É–¥–∏—Ç–æ—Ä–∏–∏ –∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ evergreen-—Ç–∞–π—Ç–ª–æ–≤.">
            <div class="label">Steam Reviews</div>
            <div class="val green">üü¢ –ê–∫—Ç–∏–≤–µ–Ω</div>
            <div style="font-size: 12px; margin-top: 12px; color: var(--muted);">
              <div style="margin-bottom: 8px;">üìà Coverage: <strong>${steamReviewsCoverage.pct || 0}%</strong> (${steamReviewsCoverage.apps_with_signals || 0}/${steamReviewsCoverage.total_apps || 0})</div>
              ${steamReviewsFreshness.last_captured_at ? `<div style="margin-bottom: 8px; font-size: 11px; color: var(--muted);">üïê –ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ: ${steamReviewsFreshness.last_captured_at}${steamReviewsFreshness.age_minutes !== null ? ` (${steamReviewsFreshness.age_minutes} –º–∏–Ω –Ω–∞–∑–∞–¥)` : ''}</div>` : '<div style="margin-bottom: 8px; font-size: 11px; color: var(--muted);">üïê –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö</div>'}
              <div style="margin-bottom: 8px;">
                <div style="font-weight: 600; margin-bottom: 4px;">üéØ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤:</div>
                <div style="margin-left: 8px;">‚Ä¢ Emerging Score</div>
                <div style="margin-left: 8px;">‚Ä¢ Evergreen Filter</div>
              </div>
              <div style="margin-top: 8px; padding-top: 8px; border-top: 1px solid rgba(255,255,255,0.1);">
                ‚öñÔ∏è –í–µ—Å –≤ —Å–∫–æ—Ä–∏–Ω–≥–µ: <strong style="color: var(--green);">–≤—ã—Å–æ–∫–∏–π</strong>
              </div>
            </div>
          </div>
        `;
      }
      
      // Steam Store - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—Å–µ–≥–¥–∞
      const steamStoreCoverage = signalsCoverage.steam_store || {apps_with_signals: 0, signals_total: 0, total_apps: 0, pct: 0, active: false};
      const steamStoreActive = steamStoreCoverage.active;
      const steamStoreFreshness = signalsFreshness.steam_store || {last_captured_at: null, age_minutes: null};
      
      html += `
        <div class="kpi" style="min-height: 200px;" title="–î–∞–Ω–Ω—ã–µ –∏–∑ Steam Store API. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö –∏–≥—Ä.">
          <div class="label">Steam Store</div>
          <div class="val ${steamStoreActive ? 'green' : 'orange'}">${steamStoreActive ? 'üü¢ –ï—Å—Ç—å –¥–∞–Ω–Ω—ã–µ' : 'üü† –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö'}</div>
          <div style="font-size: 12px; margin-top: 12px; color: var(--muted);">
            <div style="margin-bottom: 8px;">üìä –ò–≥—Ä —Å —Å–∏–≥–Ω–∞–ª–∞–º–∏: <strong>${steamStoreCoverage.apps_with_signals || 0}</strong></div>
            <div style="margin-bottom: 8px;">üìà –í—Å–µ–≥–æ —Å–∏–≥–Ω–∞–ª–æ–≤ (24—á): <strong>${steamStoreCoverage.signals_total || 0}</strong></div>
            <div style="margin-bottom: 8px;">üìà Coverage: <strong>${steamStoreCoverage.pct || 0}%</strong> (${steamStoreCoverage.apps_with_signals || 0}/${steamStoreCoverage.total_apps || 0})</div>
            ${steamStoreFreshness.last_captured_at ? `
            <div style="margin-bottom: 8px; font-size: 11px; color: var(--muted);">
              üïê –ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ: ${steamStoreFreshness.last_captured_at}
              ${steamStoreFreshness.age_minutes !== null ? ` (${steamStoreFreshness.age_minutes} –º–∏–Ω –Ω–∞–∑–∞–¥)` : ''}
            </div>
            ` : '<div style="margin-bottom: 8px; font-size: 11px; color: var(--muted);">üïê –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö</div>'}
            <div style="margin-bottom: 8px;">
              <div style="font-weight: 600; margin-bottom: 4px;">üéØ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤:</div>
              <div style="margin-left: 8px;">‚Ä¢ –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –∏–≥—Ä</div>
              <div style="margin-left: 8px;">‚Ä¢ –û–±–æ–≥–∞—â–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö</div>
            </div>
            <div style="margin-top: 8px; padding-top: 8px; border-top: 1px solid rgba(255,255,255,0.1);">
              ‚öñÔ∏è –í–µ—Å –≤ —Å–∫–æ—Ä–∏–Ω–≥–µ: <strong style="color: var(--orange);">—Å—Ä–µ–¥–Ω–∏–π</strong>
            </div>
          </div>
        </div>
      `;
      
      // Reddit - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—Å–µ–≥–¥–∞
      const redditCoverage = signalsCoverage.reddit || {apps_with_signals: 0, signals_total: 0, total_apps: 0, pct: 0, active: false};
      const redditActive = redditCoverage.active;
      const redditFreshness = signalsFreshness.reddit || {last_captured_at: null, age_minutes: null};
      
      html += `
        <div class="kpi" style="min-height: 200px;" title="–†–∞–Ω–Ω–∏–π –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –æ–±—Å—É–∂–¥–µ–Ω–∏–π. –ß–∞—Å—Ç–æ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –¥–æ —Ä–æ—Å—Ç–∞ –æ—Ç–∑—ã–≤–æ–≤ –≤ Steam.">
          <div class="label">Reddit</div>
          <div class="val ${redditActive ? 'green' : 'orange'}">${redditActive ? 'üü¢ –ï—Å—Ç—å –¥–∞–Ω–Ω—ã–µ' : '‚è∏Ô∏è –ù–µ —É—á–∞—Å—Ç–≤—É–µ—Ç'}</div>
          <div style="font-size: 12px; margin-top: 12px; color: var(--muted);">
            <div style="margin-bottom: 8px;">üìä –ò–≥—Ä —Å —Å–∏–≥–Ω–∞–ª–∞–º–∏: <strong>${redditCoverage.apps_with_signals || 0}</strong></div>
            <div style="margin-bottom: 8px;">üìà –í—Å–µ–≥–æ —Å–∏–≥–Ω–∞–ª–æ–≤ (24—á): <strong>${redditCoverage.signals_total || 0}</strong></div>
            <div style="margin-bottom: 8px;">üìà Coverage: <strong>${redditCoverage.pct || 0}%</strong> (${redditCoverage.apps_with_signals || 0}/${redditCoverage.total_apps || 0})</div>
            ${redditFreshness.last_captured_at ? `
            <div style="margin-bottom: 8px; font-size: 11px; color: var(--muted);">
              üïê –ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ: ${redditFreshness.last_captured_at}
              ${redditFreshness.age_minutes !== null ? ` (${redditFreshness.age_minutes} –º–∏–Ω –Ω–∞–∑–∞–¥)` : ''}
            </div>
            ` : '<div style="margin-bottom: 8px; font-size: 11px; color: var(--muted);">üïê –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö</div>'}
            <div style="margin-bottom: 8px;">
              <div style="font-weight: 600; margin-bottom: 4px;">üéØ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤:</div>
              <div style="margin-left: 8px; ${!redditActive ? 'color: var(--muted);' : ''}">‚Ä¢ Emerging Score (early signal)</div>
              <div style="margin-left: 8px; ${!redditActive ? 'color: var(--muted);' : ''}">‚Ä¢ Stage detection</div>
            </div>
            <div style="margin-top: 8px; padding-top: 8px; border-top: 1px solid rgba(255,255,255,0.1);">
              ‚öñÔ∏è –í–µ—Å –≤ —Å–∫–æ—Ä–∏–Ω–≥–µ: <strong style="color: ${redditActive ? 'var(--orange)' : 'var(--muted)'};">${redditActive ? '—Å—Ä–µ–¥–Ω–∏–π' : '–Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è'}</strong>
            </div>
          </div>
        </div>
      `;
      
      // YouTube - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—Å–µ–≥–¥–∞
      const youtubeCoverage = signalsCoverage.youtube || {apps_with_signals: 0, signals_total: 0, total_apps: 0, pct: 0, active: false};
      const youtubeActive = youtubeCoverage.active;
      const youtubeFreshness = signalsFreshness.youtube || {last_captured_at: null, age_minutes: null};
      
      html += `
        <div class="kpi" style="min-height: 200px;" title="–í–∏–∑—É–∞–ª—å–Ω—ã–π –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∏–Ω—Ç–µ—Ä–µ—Å–∞. –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø–æ—è–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –æ –∏–≥—Ä–µ.">
          <div class="label">YouTube</div>
          <div class="val ${youtubeActive ? 'green' : 'orange'}">${youtubeActive ? 'üü¢ –ï—Å—Ç—å –¥–∞–Ω–Ω—ã–µ' : '‚è∏Ô∏è –ù–µ —É—á–∞—Å—Ç–≤—É–µ—Ç'}</div>
          <div style="font-size: 12px; margin-top: 12px; color: var(--muted);">
            <div style="margin-bottom: 8px;">üìä –ò–≥—Ä —Å —Å–∏–≥–Ω–∞–ª–∞–º–∏: <strong>${youtubeCoverage.apps_with_signals || 0}</strong></div>
            <div style="margin-bottom: 8px;">üìà –í—Å–µ–≥–æ —Å–∏–≥–Ω–∞–ª–æ–≤ (24—á): <strong>${youtubeCoverage.signals_total || 0}</strong></div>
            <div style="margin-bottom: 8px;">üìà Coverage: <strong>${youtubeCoverage.pct || 0}%</strong> (${youtubeCoverage.apps_with_signals || 0}/${youtubeCoverage.total_apps || 0})</div>
            ${youtubeFreshness.last_captured_at ? `
            <div style="margin-bottom: 8px; font-size: 11px; color: var(--muted);">
              üïê –ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ: ${youtubeFreshness.last_captured_at}
              ${youtubeFreshness.age_minutes !== null ? ` (${youtubeFreshness.age_minutes} –º–∏–Ω –Ω–∞–∑–∞–¥)` : ''}
            </div>
            ` : '<div style="margin-bottom: 8px; font-size: 11px; color: var(--muted);">üïê –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö</div>'}
            <div style="margin-bottom: 8px;">
              <div style="font-weight: 600; margin-bottom: 4px;">üéØ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤:</div>
              <div style="margin-left: 8px; ${!youtubeActive ? 'color: var(--muted);' : ''}">‚Ä¢ Emerging Score (momentum)</div>
              <div style="margin-left: 8px; ${!youtubeActive ? 'color: var(--muted);' : ''}">‚Ä¢ Stage detection</div>
            </div>
            <div style="margin-top: 8px; padding-top: 8px; border-top: 1px solid rgba(255,255,255,0.1);">
              ‚öñÔ∏è –í–µ—Å –≤ —Å–∫–æ—Ä–∏–Ω–≥–µ: <strong style="color: ${youtubeActive ? 'var(--orange)' : 'var(--muted)'};">${youtubeActive ? '—Å—Ä–µ–¥–Ω–∏–π' : '–Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è'}</strong>
            </div>
          </div>
        </div>
      `;
      
      html += '</div>';
      
      // 3. –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ —á–∏—Å–ª–æ–≤—ã—Ö —Å–∏–≥–Ω–∞–ª–æ–≤
      if(signals.length > 0) {
        html += '<h3 style="margin-top: 24px; font-size: 20px; margin-bottom: 12px;">–ß–∏—Å–ª–æ–≤—ã–µ —Å–∏–≥–Ω–∞–ª—ã (—Å–µ–≥–æ–¥–Ω—è)</h3>';
        html += '<table class="table" style="margin-top: 12px;"><thead><tr><th>–°–∏–≥–Ω–∞–ª</th><th>–ò—Å—Ç–æ—á–Ω–∏–∫</th><th>–ì–¥–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è</th><th>–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ</th><th>–í—Å–µ–≥–æ</th><th>–ß–∏—Å–ª–æ–≤—ã—Ö</th></tr></thead><tbody>';
        signals.forEach(s => {
          html += `
            <tr>
              <td><strong>${esc(s.signal_type || 'N/A')}</strong></td>
              <td>${esc(s.source || 'Unknown')}</td>
              <td>${esc(s.usage || '–ù–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è')}</td>
              <td style="color: var(--muted); font-size: 12px;">${esc(s.purpose || '–ù–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ')}</td>
              <td>${s.rows || 0}</td>
              <td>${s.numeric_rows || 0}</td>
            </tr>
          `;
        });
        html += '</tbody></table>';
      }
      
      // Engine v4: –°–æ–±—ã—Ç–∏—è –∑–∞ 24 —á–∞—Å–∞
      try {
        const events24h = summary?.events_24h || {};
        const eventsBySource = events24h.events_by_source || {};
        const topEvents = events24h.top_events || [];
        
        if (Object.keys(eventsBySource).length > 0) {
          html += '<h3 style="margin-top: 24px; font-size: 20px; margin-bottom: 12px;">üìä –°–æ–±—ã—Ç–∏—è –∑–∞ 24 —á–∞—Å–∞</h3>';
          html += '<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 12px; margin-bottom: 16px;">';
          
          Object.entries(eventsBySource).forEach(([source, data]) => {
            const sourceName = source === 'steam_news' ? 'Steam News' : 
                              source === 'reddit' ? 'Reddit' : 
                              source === 'youtube' ? 'YouTube' : source;
            const matched = data.matched || 0;
            const unmatched = data.unmatched || 0;
            const total = matched + unmatched;
            const matchPct = total > 0 ? Math.round((matched / total) * 100) : 0;
            
            html += `
              <div style="background: rgba(255,255,255,0.03); padding: 12px; border-radius: 4px; border-left: 3px solid var(--blue);">
                <div style="font-weight: 600; margin-bottom: 8px;">${sourceName}</div>
                <div style="font-size: 12px; color: var(--muted);">
                  <div>–í—Å–µ–≥–æ: <strong>${total}</strong></div>
                  <div>–°–æ–≤–ø–∞–¥–µ–Ω–∏–π: <strong style="color: var(--green);">${matched}</strong> (${matchPct}%)</div>
                  <div>–ë–µ–∑ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π: <strong style="color: var(--orange);">${unmatched}</strong></div>
                  ${data.last_published_at ? `<div style="margin-top: 4px; font-size: 11px;">–ü–æ—Å–ª–µ–¥–Ω–µ–µ: ${data.last_published_at}</div>` : ''}
                </div>
              </div>
            `;
          });
          
          html += '</div>';
          
          // Top 20 —Å–æ–±—ã—Ç–∏–π
          if (topEvents.length > 0) {
            html += '<h4 style="margin-top: 16px; font-size: 16px; margin-bottom: 8px;">–¢–æ–ø-20 —Å–æ–±—ã—Ç–∏–π –∑–∞ 24 —á–∞—Å–∞</h4>';
            html += '<table class="table" style="margin-top: 8px; font-size: 12px;"><thead><tr><th>–ò—Å—Ç–æ—á–Ω–∏–∫</th><th>–ù–∞–∑–≤–∞–Ω–∏–µ</th><th>–ò–≥—Ä–∞</th><th>–û–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–æ</th><th>–°—Å—ã–ª–∫–∞</th></tr></thead><tbody>';
            
            topEvents.slice(0, 20).forEach(ev => {
              const sourceIcon = ev.source === 'steam_news' ? 'üì∞' : 
                               ev.source === 'reddit' ? 'üí¨' : 
                               ev.source === 'youtube' ? 'üé•' : 'üîó';
              const gameName = ev.game_name || `App ${ev.steam_app_id || '?'}`;
              const published = ev.published_at ? new Date(ev.published_at).toLocaleString('ru-RU', {day: '2-digit', month: '2-digit', hour: '2-digit', minute: '2-digit'}) : '‚Äî';
              
              html += `
                <tr>
                  <td>${sourceIcon} ${esc(ev.source || '‚Äî')}</td>
                  <td style="max-width: 200px; overflow: hidden; text-overflow: ellipsis;" title="${esc(ev.title || '‚Äî')}">${esc((ev.title || '‚Äî').substring(0, 50))}</td>
                  <td>${esc(gameName)}</td>
                  <td style="color: var(--muted);">${published}</td>
                  <td><a href="${esc(ev.url || '#')}" target="_blank" rel="noopener noreferrer" style="color: var(--blue);">üîó</a></td>
                </tr>
              `;
            });
            
            html += '</tbody></table>';
          }
        }
      } catch(e) {
        // Ignore if events_24h doesn't exist yet
      }
      
      // 4. –ë–ª–æ–∫ "–í–ª–∏—è–Ω–∏–µ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –Ω–∞ Emerging" (Engine v5: —Ä–µ–∞–ª—å–Ω–æ–µ –≤–ª–∏—è–Ω–∏–µ –Ω–∞ –æ—Å–Ω–æ–≤–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤)
      const influenceData = window.emergingInfluenceData || {};
      const gamesFound = influenceData.games_found || emergingInfluence.games_found || 0;
      html += `
        <div style="background: rgba(255,193,7,0.1); border-left: 3px solid var(--orange); padding: 16px; margin-top: 24px; border-radius: 4px;">
          <h3 style="margin: 0 0 12px 0; font-size: 18px; color: var(--orange);">üî• –í–ª–∏—è–Ω–∏–µ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –Ω–∞ Emerging (—Å–µ–≥–æ–¥–Ω—è)</h3>
          <div style="color: var(--text); line-height: 1.8;">
            <div>üéØ –ò–≥—Ä –Ω–∞–π–¥–µ–Ω–æ: <strong>${gamesFound}</strong></div>
            <div>üö´ –û—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–æ –∫–∞–∫ evergreen: <strong>${emergingInfluence.filtered_evergreen || 0}</strong></div>
            ${gamesFound > 0 ? `
            <div style="margin-top: 12px; font-weight: 600;">üß† –í–ª–∏—è–Ω–∏–µ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ (–Ω–∞ –æ—Å–Ω–æ–≤–µ score_components):</div>
            <div style="margin-left: 16px; margin-top: 8px;">
              <div>‚Ä¢ Steam Reviews: <strong style="color: var(--green);">${influenceData.steam_pct || 0}%</strong> (${influenceData.games_with_steam || 0} –∏–≥—Ä)</div>
              <div>‚Ä¢ Reddit: <strong style="color: ${(influenceData.reddit_pct || 0) > 0 ? 'var(--orange)' : 'var(--muted)'};">${influenceData.reddit_pct || 0}%</strong> (${influenceData.games_with_reddit || 0} –∏–≥—Ä)</div>
              <div>‚Ä¢ YouTube: <strong style="color: ${(influenceData.youtube_pct || 0) > 0 ? 'var(--orange)' : 'var(--muted)'};">${influenceData.youtube_pct || 0}%</strong> (${influenceData.games_with_youtube || 0} –∏–≥—Ä)</div>
              <div style="font-size: 11px; color: var(--muted); margin-top: 6px;">–í—ã—á–∏—Å–ª–µ–Ω–æ –Ω–∞ –æ—Å–Ω–æ–≤–µ reddit_component –∏ youtube_component –∏–∑ score_components</div>
              ${(influenceData.reddit_pct || 0) === 0 && (influenceData.youtube_pct || 0) === 0 ? `
              <div style="font-size: 11px; color: var(--orange); margin-top: 6px; font-weight: 600;">
                ‚ö†Ô∏è Reddit/YouTube –Ω–µ –≤–ª–∏—è—é—Ç: –ª–∏–±–æ –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö, –ª–∏–±–æ anti-hype –∑–∞—â–∏—Ç–∞ —Å–Ω–∏–∑–∏–ª–∞ –≤–ª–∏—è–Ω–∏–µ
              </div>
              ` : ''}
            </div>
            ` : `
            <div style="margin-top: 12px; font-weight: 600; color: var(--muted);">üìä Coverage –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ (–≤–º–µ—Å—Ç–æ –ø—Ä–æ—Ü–µ–Ω—Ç–æ–≤ emerging):</div>
            <div style="margin-left: 16px; margin-top: 8px;">
              ${signalsCoverage.steam_reviews?.active ? `<div>‚Ä¢ Steam Reviews: <strong>${signalsCoverage.steam_reviews.pct || 0}%</strong> coverage</div>` : ''}
              <div>‚Ä¢ Reddit: <strong>${signalsCoverage.reddit?.pct || 0}%</strong> coverage</div>
              <div>‚Ä¢ YouTube: <strong>${signalsCoverage.youtube?.pct || 0}%</strong> coverage</div>
              <div style="font-size: 11px; color: var(--muted); margin-top: 6px;">–ù–µ—Ç emerging –∏–≥—Ä –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –≤–∫–ª–∞–¥–∞</div>
            </div>
            `}
            <div style="margin-top: 12px; padding-top: 12px; border-top: 1px solid rgba(255,255,255,0.1); font-style: italic; color: var(--muted); font-size: 13px;">
              Engine v5: –ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–µ –≤–ª–∏—è–Ω–∏–µ (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç lifecycle) + Anti-Hype –∑–∞—â–∏—Ç–∞
            </div>
          </div>
        </div>
      `;
      
      // 5. –ë–ª–æ–∫ "–°–ª–µ–ø—ã–µ –∑–æ–Ω—ã"
      if(blindSpots.length > 0) {
        html += `
          <div style="background: rgba(255,107,129,0.1); border-left: 3px solid rgba(255,107,129,0.85); padding: 16px; margin-top: 24px; border-radius: 4px;">
            <h3 style="margin: 0 0 12px 0; font-size: 18px; color: rgba(255,107,129,0.85);">‚ö†Ô∏è –°–ª–µ–ø—ã–µ –∑–æ–Ω—ã –¥–∞–Ω–Ω—ã—Ö</h3>
            <div style="color: var(--text); line-height: 1.8;">
        `;
        blindSpots.forEach(spot => {
          const icon = spot.severity === 'high' ? 'üî¥' : spot.severity === 'medium' ? 'üü†' : 'üü°';
          html += `<div style="margin-bottom: 8px;">${icon} ${esc(spot.message)}</div>`;
        });
        html += `
            </div>
            <div style="margin-top: 12px; padding-top: 12px; border-top: 1px solid rgba(255,255,255,0.1); font-style: italic; color: var(--muted); font-size: 13px;">
              –≠—Ç–æ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–∞—è –ø—Ä–∞–≤–¥–∞, –∞ –Ω–µ –±–∞–≥.
            </div>
          </div>
        `;
      }
      
      sourcesList.innerHTML = html;
      
    }catch(e){
      sourcesList.innerHTML = `<div class='status' style='color: rgba(255,107,129,0.85);'>–û—à–∏–±–∫–∞: ${esc(e.message)}</div>`;
    }
  }

  // ==========================================
  // Games
  // ==========================================
  let gamesAll = [];
  let gamesFilter = "all";
  
  async function loadGames(){
    const st = qs("#games-status");
    const list = qs("#games-list");
    
    if(!st) return;
    
    try{
      st.textContent = "–ó–∞–≥—Ä—É–∑–∫–∞...";
      const health = await jget(`${API}/games/health`).catch(() => null);
      const gamesResponse = await jget(`${API}/games/list?limit=200`).catch(() => null);
      
      // –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –Ω–æ–≤–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∞ {total, items} –∏ —Å—Ç–∞—Ä–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∞ –º–∞—Å—Å–∏–≤–∞
      let rows = [];
      if (gamesResponse) {
        if (Array.isArray(gamesResponse)) {
          rows = gamesResponse;
        } else if (gamesResponse.items && Array.isArray(gamesResponse.items)) {
          rows = gamesResponse.items;
        }
      }
      
      if(health && rows.length > 0) {
        gamesAll = rows;
        st.textContent = `OK: ${health.status || 'unknown'}. –ò–≥—Ä: ${rows.length}`;
        renderGames();
      } else if (health) {
        st.textContent = `OK: ${health.status || 'unknown'}. –ò–≥—Ä: 0`;
        if(list) list.innerHTML = "<div class='status' style='padding: 20px; text-align: center; color: var(--muted);'>–ò–≥—Ä—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö.</div>";
      } else {
        st.textContent = `Backend –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç. –ü—Ä–æ–≤–µ—Ä—å, —á—Ç–æ —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω.`;
        st.style.color = "rgba(255,107,129,0.85)";
        if(list) list.style.display = "none";
      }
    }catch(e){
      st.textContent = `–û—à–∏–±–∫–∞: ${esc(e.message)}`;
      st.style.color = "rgba(255,107,129,0.85)";
      if(list) list.style.display = "none";
    }
  }
  
  function renderGames(){
    const list = qs("#games-list");
    if(!list) return;
    
    let filtered = gamesAll;
    
    if(gamesFilter === "with-reviews") {
      filtered = gamesAll.filter(g => (g.review_count || g.reviews || g.reviews_total) > 0);
    } else if(gamesFilter === "with-signals") {
      // TODO: —Ñ–∏–ª—å—Ç—Ä –ø–æ –Ω–∞–ª–∏—á–∏—é —Å–∏–≥–Ω–∞–ª–æ–≤ (–Ω—É–∂–µ–Ω –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π API)
      filtered = gamesAll;
    } else if(gamesFilter === "in-trends") {
      // TODO: —Ñ–∏–ª—å—Ç—Ä –ø–æ —É—á–∞—Å—Ç–∏—é –≤ —Ç—Ä–µ–Ω–¥–∞—Ö (–Ω—É–∂–µ–Ω –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π API)
      filtered = gamesAll;
    }
    
    if(filtered.length === 0) {
      list.style.display = "block";
      list.innerHTML = "–ù–µ—Ç –∏–≥—Ä –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è";
      return;
    }
    
    list.style.display = "block";
    list.innerHTML = filtered.map(r => {
      const name = r.name || r.title || "‚Äî";
      const appId = r.steam_app_id || r.source_id || "‚Äî";
      const reviews = r.review_count || r.reviews || r.reviews_total || 0;
      const steamUrl = r.steam_url || `https://store.steampowered.com/app/${appId}/`;
      
      return `
        <div style="padding:12px; border-bottom:1px solid rgba(255,255,255,0.06); display: flex; justify-content: space-between; align-items: center;">
          <div>
            <a href="${esc(steamUrl)}" target="_blank" rel="noopener noreferrer" style="color: var(--blue); text-decoration: underline; text-decoration-color: rgba(110,168,255,0.5); font-weight: 700; font-size: 16px;">
              ${esc(name)}
            </a>
            <span style="color: var(--muted); font-size: 11px; margin-left: 6px;">(#${esc(String(appId))})</span>
          </div>
          <div style="color:rgba(255,255,255,0.6);">
            –û—Ç–∑—ã–≤–æ–≤: ${reviews}
          </div>
        </div>
      `;
    }).join("");
  }
  
  // –§–∏–ª—å—Ç—Ä—ã –¥–ª—è –∏–≥—Ä
  qsa("#panel-games .chip[data-games-filter]").forEach(ch => {
    ch.addEventListener("click", () => {
      qsa("#panel-games .chip").forEach(x => x.classList.remove("active"));
      ch.classList.add("active");
      gamesFilter = ch.dataset.gamesFilter || "all";
      renderGames();
    });
  });
  
  // –§–∏–ª—å—Ç—Ä—ã –¥–ª—è —Ç—Ä–µ–Ω–¥–æ–≤ (Lifecycle Intelligence v5)
  let trendsLifecycleFilter = "all";
  let trendsConfidenceFilter = "all";
  
  function applyTrendsFilters() {
    const table = qs("#trends-emerging-table table tbody");
    if (!table) return;
    
    const rows = Array.from(table.querySelectorAll("tr"));
    rows.forEach(row => {
      let show = true;
      
      // –§–∏–ª—å—Ç—Ä –ø–æ –∂–∏–∑–Ω–µ–Ω–Ω–æ–º—É —Ü–∏–∫–ª—É
      if (trendsLifecycleFilter !== "all") {
        const lifecycleCell = row.querySelector("td:nth-child(7)");
        if (lifecycleCell) {
          const lifecycleText = lifecycleCell.textContent || "";
          const lifecycleRaw = row.dataset.lifecycleStage || "";
          if (trendsLifecycleFilter !== lifecycleRaw && !lifecycleText.includes(trendsLifecycleFilter)) {
            show = false;
          }
        }
      }
      
      // –§–∏–ª—å—Ç—Ä –ø–æ confidence
      if (trendsConfidenceFilter === "high") {
        const confidenceCell = row.querySelector("td:nth-child(5)");
        if (confidenceCell) {
          const confidenceText = confidenceCell.textContent || "";
          if (!confidenceText.includes("–í—ã—Å–æ–∫–∞—è")) {
            show = false;
          }
        }
      }
      
      row.style.display = show ? "" : "none";
    });
  }
  
  qsa("#trends-filters .chip[data-filter-lifecycle]").forEach(ch => {
    ch.addEventListener("click", () => {
      qsa("#trends-filters .chip[data-filter-lifecycle]").forEach(x => x.classList.remove("active"));
      ch.classList.add("active");
      trendsLifecycleFilter = ch.dataset.filterLifecycle || "all";
      applyTrendsFilters();
    });
  });
  
  qsa("#trends-filters .chip[data-filter-confidence]").forEach(ch => {
    ch.addEventListener("click", () => {
      const wasActive = ch.classList.contains("active");
      qsa("#trends-filters .chip[data-filter-confidence]").forEach(x => x.classList.remove("active"));
      if (!wasActive) {
        ch.classList.add("active");
        trendsConfidenceFilter = ch.dataset.filterConfidence || "all";
      } else {
        trendsConfidenceFilter = "all";
      }
      applyTrendsFilters();
    });
  });

  // ==========================================
  // –î–µ–π—Å—Ç–≤–∏—è
  // ==========================================
  let actionLog = [];
  
  function addActionLog(message, isError = false) {
    const timestamp = new Date().toLocaleTimeString('ru-RU');
    actionLog.unshift(`[${timestamp}] ${message}`);
    if(actionLog.length > 50) actionLog.pop();
    
    const logEl = qs("#action-log");
    if(logEl) {
      logEl.innerHTML = actionLog.map(msg => {
        const color = isError ? 'var(--red)' : 'var(--muted)';
        return `<div style="color: ${color}; margin: 4px 0;">${esc(msg)}</div>`;
      }).join("");
    }
  }
  
  async function loadActions(){
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–Ω–æ–ø–æ–∫ —É–∂–µ –≤ HTML, –ø—Ä–æ—Å—Ç–æ –æ–±–Ω–æ–≤–ª—è–µ–º –ª–æ–≥
    addActionLog("–í–∫–ª–∞–¥–∫–∞ –¥–µ–π—Å—Ç–≤–∏–π –∑–∞–≥—Ä—É–∂–µ–Ω–∞");
  }
  
  // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–Ω–æ–ø–æ–∫ –¥–µ–π—Å—Ç–≤–∏–π
  const btnSeed = qs("#btn-action-seed");
  if(btnSeed) {
    btnSeed.addEventListener("click", async () => {
      btnSeed.disabled = true;
      addActionLog("–ó–∞–ø—É—Å–∫: Seed Apps...");
      try {
        const result = await jpost(`${API}/admin/system/action`, {action: "seed"});
        addActionLog(`‚úì ${result.message || 'Seed –∑–∞–≤–µ—Ä—à—ë–Ω'}`);
        showToast(result.ok ? "Seed –≤—ã–ø–æ–ª–Ω–µ–Ω" : "–û—à–∏–±–∫–∞ seed", !result.ok);
        if(result.ok) await loadSystem();
      } catch(e) {
        addActionLog(`‚úó –û—à–∏–±–∫–∞: ${e.message}`, true);
        showToast(`–û—à–∏–±–∫–∞: ${e.message}`, true);
      } finally {
        btnSeed.disabled = false;
      }
    });
  }
  
  const btnCollect = qs("#btn-action-collect");
  if(btnCollect) {
    btnCollect.addEventListener("click", async () => {
      btnCollect.disabled = true;
      addActionLog("–ó–∞–ø—É—Å–∫: Collect Jobs...");
      try {
        const result = await jpost(`${API}/admin/system/action`, {action: "collect"});
        addActionLog(`‚úì ${result.message || 'Collect –∑–∞–≤–µ—Ä—à—ë–Ω'}`);
        showToast(result.ok ? "Jobs —Å–æ–∑–¥–∞–Ω—ã" : "–û—à–∏–±–∫–∞ collect", !result.ok);
        if(result.ok) await loadSystem();
      } catch(e) {
        addActionLog(`‚úó –û—à–∏–±–∫–∞: ${e.message}`, true);
        showToast(`–û—à–∏–±–∫–∞: ${e.message}`, true);
      } finally {
        btnCollect.disabled = false;
      }
    });
  }
  
  const btnIngest = qs("#btn-action-ingest");
  if(btnIngest) {
    btnIngest.addEventListener("click", async () => {
      btnIngest.disabled = true;
      addActionLog("–ó–∞–ø—É—Å–∫: Ingest Reviews...");
      try {
        const result = await jpost(`${API}/admin/system/action`, {action: "ingest_reviews"});
        addActionLog(`‚úì ${result.message || 'Ingest –∑–∞–≤–µ—Ä—à—ë–Ω'}`);
        showToast(result.ok ? "Reviews –æ–±—Ä–∞–±–æ—Ç–∞–Ω—ã" : "–û—à–∏–±–∫–∞ ingest", !result.ok);
        if(result.ok) {
          await loadSystem();
          await loadTrends();
        }
      } catch(e) {
        addActionLog(`‚úó –û—à–∏–±–∫–∞: ${e.message}`, true);
        showToast(`–û—à–∏–±–∫–∞: ${e.message}`, true);
      } finally {
        btnIngest.disabled = false;
      }
    });
  }
  
  const btnAggregate = qs("#btn-action-aggregate");
  if(btnAggregate) {
    btnAggregate.addEventListener("click", async () => {
      btnAggregate.disabled = true;
      addActionLog("–ó–∞–ø—É—Å–∫: Aggregate...");
      try {
        const result = await jpost(`${API}/admin/system/action`, {action: "aggregate"});
        addActionLog(`‚úì ${result.message || 'Aggregate –∑–∞–≤–µ—Ä—à—ë–Ω'}`);
        showToast(result.ok ? "Aggregation –≤—ã–ø–æ–ª–Ω–µ–Ω–∞" : "–û—à–∏–±–∫–∞ aggregate", !result.ok);
        if(result.ok) {
          await loadSystem();
          await loadTrends();
        }
      } catch(e) {
        addActionLog(`‚úó –û—à–∏–±–∫–∞: ${e.message}`, true);
        showToast(`–û—à–∏–±–∫–∞: ${e.message}`, true);
      } finally {
        btnAggregate.disabled = false;
      }
    });
  }
  
  const btnVerify = qs("#btn-action-verify");
  if(btnVerify) {
    btnVerify.addEventListener("click", async () => {
      btnVerify.disabled = true;
      addActionLog("–ó–∞–ø—É—Å–∫: –ü–æ–ª–Ω—ã–π Pipeline (Seed ‚Üí Collect ‚Üí Ingest ‚Üí Aggregate)...");
      const resultEl = qs("#action-result");
      
      try {
        // –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫ –≤—Å–µ—Ö —ç—Ç–∞–ø–æ–≤
        addActionLog("1/4: Seed Apps...");
        const seedResult = await jpost(`${API}/admin/system/action`, {action: "seed"});
        addActionLog(`   ${seedResult.ok ? '‚úì' : '‚úó'} ${seedResult.message}`);
        
        addActionLog("2/4: Collect Jobs...");
        const collectResult = await jpost(`${API}/admin/system/action`, {action: "collect"});
        addActionLog(`   ${collectResult.ok ? '‚úì' : '‚úó'} ${collectResult.message}`);
        
        // –ñ–¥—ë–º –Ω–µ–º–Ω–æ–≥–æ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ jobs
        addActionLog("   –û–∂–∏–¥–∞–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ jobs (10 —Å–µ–∫)...");
        await new Promise(resolve => setTimeout(resolve, 10000));
        
        addActionLog("3/4: Ingest Reviews...");
        const ingestResult = await jpost(`${API}/admin/system/action`, {action: "ingest_reviews"});
        addActionLog(`   ${ingestResult.ok ? '‚úì' : '‚úó'} ${ingestResult.message}`);
        
        addActionLog("4/4: Aggregate...");
        const aggregateResult = await jpost(`${API}/admin/system/action`, {action: "aggregate"});
        addActionLog(`   ${aggregateResult.ok ? '‚úì' : '‚úó'} ${aggregateResult.message}`);
        
        addActionLog("‚úì Pipeline –∑–∞–≤–µ—Ä—à—ë–Ω");
        showToast("Pipeline –≤—ã–ø–æ–ª–Ω–µ–Ω —É—Å–ø–µ—à–Ω–æ");
        
        if(resultEl) {
          resultEl.style.display = "block";
          resultEl.innerHTML = `
            <b>Pipeline –≤—ã–ø–æ–ª–Ω–µ–Ω</b><br/>
            Seed: ${seedResult.ok ? '‚úì' : '‚úó'}<br/>
            Collect: ${collectResult.ok ? '‚úì' : '‚úó'}<br/>
            Ingest: ${ingestResult.ok ? '‚úì' : '‚úó'}<br/>
            Aggregate: ${aggregateResult.ok ? '‚úì' : '‚úó'}
          `;
        }
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ
        await loadSystem();
        await loadTrends();
        
      } catch(e) {
        addActionLog(`‚úó –û—à–∏–±–∫–∞ pipeline: ${e.message}`, true);
        showToast(`–û—à–∏–±–∫–∞: ${e.message}`, true);
        if(resultEl) {
          resultEl.style.display = "block";
          resultEl.innerHTML = `<b>–û—à–∏–±–∫–∞</b><br/>${esc(e.message)}`;
          resultEl.style.borderColor = "rgba(255,107,129,0.35)";
        }
      } finally {
        btnVerify.disabled = false;
      }
    });
  }

  // ==========================================
  // Relaunch ‚Äî —è–¥—Ä–æ —Ñ–∏—à–∫–∏
  // ==========================================
  let relaunchAll = [];
  let relaunchFilter = "all";

  function classifyCounts(items){
    const c = {candidate:0, watchlist:0, rejected:0};
    for(const it of items){
      if(it.classification === "watchlist") c.watchlist++;
      else if(it.classification === "rejected") c.rejected++;
      else c.candidate++;
    }
    return c;
  }

  function scoreClass(v){
    if(v >= 70) return "good";
    if(v >= 40) return "mid";
    return "";
  }

  function renderRelaunch(items){
    const box = qs("#relaunch-cards");
    const hint = qs("#relaunch-hint");
    if(!box) return;

    const show = (relaunchFilter === "all")
      ? items
      : items.filter(x => x.classification === relaunchFilter);

    // –ü–æ–¥—Å–∫–∞–∑–∫–∞: –µ—Å–ª–∏ –≤–æ–æ–±—â–µ –ø—É—Å—Ç–æ ‚Äî –ø–æ–∫–∞–∂–µ–º guidance
    if(hint){
      hint.style.display = (items.length === 0) ? "block" : "none";
    }

    if(!show.length){
      box.innerHTML = `
        <div class="status">
          –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞: <b>${esc(relaunchFilter)}</b><br/>
          –ï—Å–ª–∏ —É —Ç–µ–±—è –ø–æ–∫–∞ –º–∞–ª–æ –∏–≥—Ä ‚Äî –Ω–∞–∂–º–∏ <b>Bulk Track</b> (200+ –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤) –∏ –æ–±–Ω–æ–≤–∏.
        </div>
      `;
                return;
            }
            
    box.innerHTML = show.map(app => {
      const score = Number(app.relaunch_score || 0);
      const cls = scoreClass(score);

      const failure = Array.isArray(app.failure_reasons) ? app.failure_reasons : [];
      const angles = Array.isArray(app.relaunch_angles) ? app.relaunch_angles : [];
      const failureCategories = Array.isArray(app.failure_categories) ? app.failure_categories : [];
      const suggestedAngles = Array.isArray(app.suggested_angles) ? app.suggested_angles : [];

      const meta = [
        `classification: <b>${esc(app.classification ?? "candidate")}</b>`,
        `computed_at: ${esc(app.computed_at ?? "‚Äî")}`,
      ].join(" ‚Ä¢ ");

      const badgeHtml = []
        .concat(suggestedAngles.map(a => `<span class="badge">üéØ ${esc(a)}</span>`))
        .concat(failureCategories.map(f => `<span class="badge">‚ö†Ô∏è ${esc(f)}</span>`))
        .concat(angles.map(a => `<span class="badge">üìå ${esc(a)}</span>`))
        .concat(failure.map(f => `<span class="badge">‚ùå ${esc(f)}</span>`))
        .slice(0, 16)
        .join("");
                
                return `
        <div class="item">
          <div class="left">
            <div class="name">
              <a href="${esc(app.steam_url || `https://store.steampowered.com/app/${app.steam_app_id}`)}" target="_blank" style="color: inherit; text-decoration: none;">
                ${esc(app.name ?? "‚Äî")}
                <span style="color:rgba(255,255,255,0.6)">(#${esc(app.steam_app_id)})</span>
              </a>
            </div>
            <div class="meta">${meta}</div>
            ${badgeHtml ? `<div class="badges">${badgeHtml}</div>` : ``}
            <div class="reason">${esc(app.reasoning || "‚Äî")}</div>
                                </div>
          <div class="score ${cls}">${score.toFixed(1)}</div>
                                </div>
      `;
    }).join("");
  }

  async function loadRelaunch(){
    const err = qs("#relaunch-error");
    if(err) err.style.display = "none";

    try{
      // 1) Health
      const health = await jget(`${API}/relaunch/health`).catch(() => ({tracked_apps: 0}));
      const trackedEl = qs("#relaunch-tracked");
      if(trackedEl) trackedEl.textContent = health.tracked_apps ?? 0;

      // 2) Candidates
      const items = await jget(`${API}/relaunch/candidates?min_score=0&limit=200`).catch(() => []);
      relaunchAll = Array.isArray(items) ? items : [];

      const c = classifyCounts(relaunchAll);
      const candidatesEl = qs("#relaunch-candidates");
      const watchlistEl = qs("#relaunch-watchlist");
      const rejectedEl = qs("#relaunch-rejected");
      
      if(candidatesEl) candidatesEl.textContent = relaunchAll.length;
      if(watchlistEl) watchlistEl.textContent = c.watchlist;
      if(rejectedEl) rejectedEl.textContent = c.rejected;

      renderRelaunch(relaunchAll);
    }catch(e){
      console.error("loadRelaunch error:", e);
      if(err){
        err.style.display = "block";
        err.textContent = `–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ relaunch: ${esc(e.message)}`;
      }
    }
  }

  // ==========================================
  // Actions: Track
  // ==========================================
  const btnTrack = qs("#btn-track");
  if(btnTrack) {
    btnTrack.addEventListener("click", async () => {
      const sidEl = qs("#relaunch-app-id");
      const nameEl = qs("#relaunch-app-name");
      const prEl = qs("#relaunch-track-priority");
      
      if(!sidEl || !nameEl) return;
      
      const sid = sidEl.value.trim();
      const name = nameEl.value.trim();
      const pr = prEl?.value?.trim() || "50";

      if(!sid || !name){
        showToast("–ù—É–∂–Ω–æ –∑–∞–ø–æ–ª–Ω–∏—Ç—å Steam App ID –∏ –ù–∞–∑–≤–∞–Ω–∏–µ –∏–≥—Ä—ã", true);
                return;
            }
            
      const priority = Number(pr || 50);
      const payload = {steam_app_id: Number(sid), name: name, tracking_priority: priority};

      btnTrack.disabled = true;
      const originalText = btnTrack.textContent;
      btnTrack.textContent = "–î–æ–±–∞–≤–ª–µ–Ω–∏–µ...";

      try{
        const data = await jpost(`${API}/relaunch/admin/track`, payload);
        showBox("#track-result",
          `<b>Track OK</b><br/><code>${esc(JSON.stringify(data))}</code>`,
          true
        );
        showToast("–ò–≥—Ä–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∞ –≤ —Ç—Ä–µ–∫–∏–Ω–≥");
        if(sidEl) sidEl.value = "";
        if(nameEl) nameEl.value = "";
        await loadRelaunch();
      }catch(e){
        showBox("#track-result", `<b>Track ERROR</b><br/>${esc(e.message)}`, false);
        showToast(`–û—à–∏–±–∫–∞: ${e.message}`, true);
      } finally {
        btnTrack.disabled = false;
        btnTrack.textContent = originalText;
      }
    });
  }

  const btnRefresh = qs("#btn-refresh");
  if(btnRefresh) {
    btnRefresh.addEventListener("click", loadRelaunch);
  }

  // ==========================================
  // Actions: Bulk Track
  // ==========================================
  const btnBulk = qs("#btn-bulk");
  if(btnBulk) {
    btnBulk.addEventListener("click", async () => {
      const limitEl = qs("#bulk-limit");
      const minReviewsEl = qs("#bulk-min-reviews");
      const priorityEl = qs("#bulk-priority");
      
      const limit = Number(limitEl?.value?.trim() || 200);
      const min_reviews = Number(minReviewsEl?.value?.trim() || 200);
      const tracking_priority = Number(priorityEl?.value?.trim() || 50);

      // –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π: bulk_track —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –ø–æ –ë–î (steam_games/games),
      // –ø–æ—ç—Ç–æ–º—É –µ—Å–ª–∏ —É —Ç–µ–±—è –ø–æ–∫–∞ —ç—Ç–∏ —Ç–∞–±–ª–∏—Ü—ã –ø—É—Å—Ç—ã–µ ‚Äî –æ–Ω –≤–µ—Ä–Ω—ë—Ç note.
      const payload = {limit, min_reviews, tracking_priority};

      btnBulk.disabled = true;
      const originalText = btnBulk.textContent;
      btnBulk.textContent = "–û–±—Ä–∞–±–æ—Ç–∫–∞...";

      try{
        const data = await jpost(`${API}/relaunch/admin/bulk_track`, payload);
        showBox("#bulk-result",
          `<b>Bulk OK</b><br/><code>${esc(JSON.stringify(data))}</code>`,
          true
        );
        showToast(`–î–æ–±–∞–≤–ª–µ–Ω–æ –∏–≥—Ä: ${data.added || 0}`);
        await loadRelaunch();
      }catch(e){
        showBox("#bulk-result", `<b>Bulk ERROR</b><br/>${esc(e.message)}`, false);
        showToast(`–û—à–∏–±–∫–∞: ${e.message}`, true);
      } finally {
        btnBulk.disabled = false;
        btnBulk.textContent = originalText;
      }
    });
  }

  const btnBulkHelp = qs("#btn-bulk-help");
  if(btnBulkHelp) {
    btnBulkHelp.addEventListener("click", () => {
      alert(
        "Bulk Track ‚Äî —ç—Ç–æ –ø—Ä–æ–¥–∞–∫—à–Ω-—Å–ø–æ—Å–æ–± –Ω–∞–ø–æ–ª–Ω–∏—Ç—å Relaunch Scout.\n\n" +
        "–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç:\n" +
        "1) –ù–ï —Ö–æ–¥–∏—Ç –≤ Steam, –Ω–µ —Ç—Ä–µ–±—É–µ—Ç –∫–ª—é—á–µ–π.\n" +
        "2) –ò—â–µ—Ç —Ç–∞–±–ª–∏—Ü—ã steam_games –∏–ª–∏ games –≤ –≤–∞—à–µ–π –ë–î.\n" +
        "3) –ë–µ—Ä—ë—Ç —Ç–æ–ø –ø–æ –æ—Ç–∑—ã–≤–∞–º (reviews >= min_reviews) –∏ –¥–æ–±–∞–≤–ª—è–µ—Ç –≤ relaunch_apps.\n\n" +
        "–ï—Å–ª–∏ –≤–µ—Ä–Ω—É–ª 'note': –∑–Ω–∞—á–∏—Ç —Ç–∞–±–ª–∏—Ü –Ω–µ—Ç –∏–ª–∏ –¥–∞–Ω–Ω—ã—Ö –º–∞–ª–æ ‚Äî –Ω—É–∂–Ω–æ —Å–Ω–∞—á–∞–ª–∞ –Ω–∞–ø–æ–ª–Ω–∏—Ç—å –±–∞–∑—É –∏–≥—Ä."
      );
    });
  }

  // ==========================================
  // Actions: –°–∫–∞–Ω–∏—Ä–æ–≤–∞—Ç—å —Ä—ã–Ω–æ–∫
  // ==========================================
  const btnScanMarket = qs("#btn-scan-market");
  if(btnScanMarket) {
    btnScanMarket.addEventListener("click", async () => {
      const limitEl = qs("#scan-limit");
      const minReviewsEl = qs("#scan-min-reviews");
      const maxReviewsEl = qs("#scan-max-reviews");
      const priorityEl = qs("#scan-priority");
      
      const limit = Number(limitEl?.value?.trim() || 200);
      const min_reviews = Number(minReviewsEl?.value?.trim() || 50);
      const max_reviews = Number(maxReviewsEl?.value?.trim() || 5000);
      const tracking_priority = Number(priorityEl?.value?.trim() || 50);

      const payload = {
        min_months: 6,
        max_months: 36,  // MVP: —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –≥–∞—Ä–∞–Ω—Ç–∏–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
        min_reviews: min_reviews,
        max_reviews: Math.max(max_reviews, 15000),  // MVP: –º–∏–Ω–∏–º—É–º 15000 –¥–ª—è –±–æ–ª—å—à–µ–≥–æ –ø–æ–∫—Ä—ã—Ç–∏—è
        mega_hit_reviews: 50000,
        exclude_f2p: true,
        limit_seed: limit,
        limit_add: Math.min(limit, 50),
        tracking_priority: tracking_priority,
        page_start: 1,
        page_end: 15,
        strict_window: false  // MVP: –º—è–≥–∫–∏–π —Ä–µ–∂–∏–º –¥–ª—è –≥–∞—Ä–∞–Ω—Ç–∏–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
      };

      const originalText = btnScanMarket.textContent;
      btnScanMarket.disabled = true;
      btnScanMarket.textContent = "–°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ...";

      try {
        // –ò—Å–ø–æ–ª—å–∑—É–µ–º mode=quick –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ —Å–∫–∞–Ω–∞ (–¥–æ 25 —Å–µ–∫)
        const data = await jpost(`${API}/relaunch/admin/market_scan?mode=quick`, payload, 30000); // 30s timeout –¥–ª—è quick —Ä–µ–∂–∏–º–∞
        console.log("Scan market response:", data);
        
        let message = `<b>–°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä—ã–Ω–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–æ</b><br/>`;
        if (data.status === "ok" || data.status === "warning") {
          message += `Seed –Ω–∞–π–¥–µ–Ω–æ: ${data.seed_unique || data.seed_total || 0}<br/>`;
          message += `–î–µ—Ç–∞–ª–∏ –ø–æ–ª—É—á–µ–Ω—ã: ${data.details_fetched || 0}<br/>`;
          message += `Eligible: ${data.eligible || 0}<br/>`;
          message += `–î–æ–±–∞–≤–ª–µ–Ω–æ: ${data.upserted || 0} –∏–≥—Ä<br/>`;
          if (data.excluded) {
            const excludedList = Object.entries(data.excluded)
              .filter(([k, v]) => v > 0)
              .map(([k, v]) => `${k}: ${v}`)
              .join(", ");
            if (excludedList) {
              message += `<small>–ò—Å–∫–ª—é—á–µ–Ω–æ: ${esc(excludedList)}</small><br/>`;
            }
          }
          if (data.top_excluded_reasons && data.top_excluded_reasons.length > 0) {
            const reasons = data.top_excluded_reasons.map(r => `${r.reason}: ${r.count}`).join(", ");
            message += `<small>–¢–æ–ø –ø—Ä–∏—á–∏–Ω—ã: ${esc(reasons)}</small><br/>`;
          }
          if (data.note) {
            message += `<small>${esc(data.note)}</small>`;
          }
          showBox("#scan-market-result", message, data.status === "ok");
          if (data.upserted > 0) {
            showToast(`–°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ: –¥–æ–±–∞–≤–ª–µ–Ω–æ ${data.upserted} –∏–≥—Ä`);
          } else {
            showToast(`–°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ, –Ω–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ –ø–æ–¥—Ö–æ–¥—è—â–∏—Ö –∏–≥—Ä`, true);
          }
          await loadRelaunch();
        } else {
          message += `<small>${esc(data.note || data.detail || JSON.stringify(data))}</small>`;
          showBox("#scan-market-result", message, false);
          showToast(`–û—à–∏–±–∫–∞ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è: ${data.note || data.detail || '–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'}`, true);
        }
      } catch(e) {
        console.error("Scan market error:", e);
        showBox("#scan-market-result", `<b>–û—à–∏–±–∫–∞</b><br/>${esc(e.message)}`, false);
        showToast(`–û—à–∏–±–∫–∞: ${e.message}`, true);
      } finally {
        btnScanMarket.disabled = false;
        btnScanMarket.textContent = originalText;
      }
    });
  }

  // ==========================================
  // –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –≤–∫–ª–∞–¥–∫–∏ Relaunch Scout
  // ==========================================
  function switchRelaunchSubTab(subtab) {
    if(!subtab) return;
    
    // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º —Ç–∞–±—ã (—Ç–æ–ª—å–∫–æ –≤–Ω—É—Ç—Ä–∏ Relaunch)
    qsa("#panel-relaunch .tab[data-subtab]").forEach(t => {
      t.classList.toggle("active", t.dataset.subtab === subtab);
    });
    
    // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º –ø–∞–Ω–µ–ª–∏
    qsa("#panel-relaunch .relaunch-subpanel").forEach(p => {
      p.classList.add("hidden");
    });
    
    const panel = qs(`#relaunch-subpanel-${subtab}`);
    if(panel) {
      panel.classList.remove("hidden");
    }
    
    // –õ–µ–Ω–∏–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞
    if(subtab === "candidates") {
      loadRelaunch();
    }
  }
  
  // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö –≤–∫–ª–∞–¥–æ–∫ Relaunch
  qsa("#panel-relaunch .tab[data-subtab]").forEach(t => {
    t.addEventListener("click", () => switchRelaunchSubTab(t.dataset.subtab));
  });

  // ==========================================
  // Filters (—Ç–æ–ª—å–∫–æ –¥–ª—è –≤–∫–ª–∞–¥–∫–∏ Candidates)
  // ==========================================
  qsa("#panel-relaunch .chip").forEach(ch => {
    ch.addEventListener("click", () => {
      qsa("#panel-relaunch .chip").forEach(x => x.classList.remove("active"));
      ch.classList.add("active");
      relaunchFilter = ch.dataset.filter || "all";
      renderRelaunch(relaunchAll);
    });
  });

  // ==========================================
  // Diagnosis Action
  // ==========================================
  const btnDiagnose = qs("#btn-diagnose");
  if(btnDiagnose) {
    btnDiagnose.addEventListener("click", async () => {
      const limitEl = qs("#diagnose-limit");
      const limit = Number(limitEl?.value?.trim() || 50);
      
      const originalText = btnDiagnose.textContent;
      btnDiagnose.disabled = true;
      btnDiagnose.textContent = "–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞...";
      
      try {
        const data = await jpost(`${API}/relaunch/admin/diagnose`, {limit: limit}, 120000); // 120s timeout
        console.log("Diagnose response:", data);
        
        let message = `<b>–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞</b><br/>`;
        if (data.status === "ok") {
          message += `–û–±—Ä–∞–±–æ—Ç–∞–Ω–æ –∏–≥—Ä: ${data.diagnosed || 0}<br/>`;
          if (data.errors && data.errors.length > 0) {
            message += `<small>–û—à–∏–±–∫–∏: ${data.errors.length}</small><br/>`;
          }
          if (data.note) {
            message += `<small>${esc(data.note)}</small>`;
          }
          showBox("#diagnose-result", message, true);
          showToast(`–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞: –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ ${data.diagnosed} –∏–≥—Ä`, false);
          await loadRelaunch(); // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤
                } else {
          message += `<small>${esc(data.note || data.detail || JSON.stringify(data))}</small>`;
          showBox("#diagnose-result", message, false);
          showToast(`–û—à–∏–±–∫–∞ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏: ${data.note || data.detail || '–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'}`, true);
        }
      } catch(e) {
        console.error("Diagnose error:", e);
        showBox("#diagnose-result", `<b>–û—à–∏–±–∫–∞</b><br/>${esc(e.message)}`, false);
        showToast(`–û—à–∏–±–∫–∞: ${e.message}`, true);
      } finally {
        btnDiagnose.disabled = false;
        btnDiagnose.textContent = originalText;
      }
    });
  }

  // ==========================================
  // Compute Scores Action
  // ==========================================
  const btnComputeScores = qs("#btn-compute-scores");
  if(btnComputeScores) {
    btnComputeScores.addEventListener("click", async () => {
      const limitEl = qs("#compute-scores-limit");
      const limit = Number(limitEl?.value?.trim() || 200);
      
      const originalText = btnComputeScores.textContent;
      btnComputeScores.disabled = true;
      btnComputeScores.textContent = "–í—ã—á–∏—Å–ª–µ–Ω–∏–µ...";
      
      try {
        const data = await jpost(`${API}/relaunch/admin/compute_scores`, {limit: limit}, 60000); // 60s timeout
        console.log("Compute scores response:", data);
        
        let message = `<b>–ü–µ—Ä–µ—Å—á—ë—Ç Scores –∑–∞–≤–µ—Ä—à—ë–Ω</b><br/>`;
        if (data.status === "ok") {
          message += `–û–±—Ä–∞–±–æ—Ç–∞–Ω–æ –∏–≥—Ä: ${data.processed || 0} –∏–∑ ${data.total || 0}<br/>`;
          if (data.errors && data.errors.length > 0) {
            message += `<small>–û—à–∏–±–∫–∏: ${data.errors.length}</small><br/>`;
          }
          if (data.note) {
            message += `<small>${esc(data.note)}</small>`;
          }
          showBox("#compute-scores-result", message, true);
          showToast(`Scores –ø–µ—Ä–µ—Å—á–∏—Ç–∞–Ω—ã: ${data.processed} –∏–≥—Ä`, false);
          await loadRelaunch(); // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤
        } else {
          message += `<small>${esc(data.note || data.detail || JSON.stringify(data))}</small>`;
          showBox("#compute-scores-result", message, false);
          showToast(`–û—à–∏–±–∫–∞ –ø–µ—Ä–µ—Å—á—ë—Ç–∞: ${data.note || data.detail || '–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'}`, true);
        }
      } catch(e) {
        console.error("Compute scores error:", e);
        showBox("#compute-scores-result", `<b>–û—à–∏–±–∫–∞</b><br/>${esc(e.message)}`, false);
        showToast(`–û—à–∏–±–∫–∞: ${e.message}`, true);
      } finally {
        btnComputeScores.disabled = false;
        btnComputeScores.textContent = originalText;
      }
    });
  }

  // ==========================================
  // –°—Ç–∞—Ä—Ç–æ–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞
  // ==========================================
  // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —É–∂–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ –≤ initializeDashboard()
  // loadSystem() –±—É–¥–µ—Ç –≤—ã–∑–≤–∞–Ω —á–µ—Ä–µ–∑ switchTab() –ø—Ä–∏ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ –≤–∫–ª–∞–¥–∫–∏ "system"
    </script>
  </div> <!-- wrap -->
</body>
</html>